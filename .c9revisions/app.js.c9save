{"ts":1373948029899,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\n/**\n * Module dependencies.\n */\n\nvar express = require('express')\n  , routes = require('./routes')\n  , user = require('./routes/user')\n  , http = require('http')\n  , path = require('path');\n\nvar app = express();\n\n// all environments\napp.set('port', process.env.PORT || 3000);\napp.set('views', __dirname + '/views');\napp.set('view engine', 'jade');\napp.use(express.favicon());\napp.use(express.logger('dev'));\napp.use(express.bodyParser());\napp.use(express.methodOverride());\napp.use(app.router);\napp.use(express.static(path.join(__dirname, 'public')));\n\n// development only\nif ('development' == app.get('env')) {\n  app.use(express.errorHandler());\n}\n\napp.get('/', routes.index);\napp.get('/users', user.list);\n\nhttp.createServer(app).listen(app.get('port'), function(){\n  console.log('Express server listening on port ' + app.get('port'));\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":843}]],"length":843}
{"contributors":[],"silentsave":false,"ts":1374377995731,"patch":[[{"diffs":[[0,"('path')"],[1,"\n  , UserProvider = require('./db').UserProvider"],[0,";\n"],[-1,""],[0,"\nvar app"]],"start1":181,"start2":181,"length1":18,"length2":66},{"diffs":[[0,"favicon("],[1,"__dirname + '/public/images/favicon.ico'"],[0,"));\napp."]],"start1":413,"start2":413,"length1":16,"length2":56},{"diffs":[[0,"index);\n"],[-1,""],[0,"app.get("]],"start1":759,"start2":759,"length1":16,"length2":16},{"diffs":[[0,"list);\n\n"],[1,"app.get('/customers', routes.customers);\napp.get('/vendors', routes.vendors);\napp.get('/delivery', routes.delivery);\napp.get('/suggestions', routes.suggestions);\napp.get('/customerService', routes.customerService);\n\n"],[0,"http.cre"]],"start1":790,"start2":790,"length1":16,"length2":232}]],"length":1147,"saved":false}
{"ts":1374378181371,"patch":[[{"diffs":[[0,"vice);\n\n"],[1,"// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"]\nvar db = new UserProvider(databaseUrl, collections).db;\n\napp.get('/vendor_list', function(req, res){\n    db.users.find({vendor: true}, function(err, users) {\n      if( err || !users) console.log(\"No vendors found\");\n      else users.forEach( function(user) {\n      console.log(user);\n      } );\n    });    \n\n  userProvider.findAll(function(error, emps){\n      res.render('index', {\n            title: 'Employees',\n            employees:emps\n        });\n  });\n});\n\n"],[0,"http.cre"]],"start1":1006,"start2":1006,"length1":16,"length2":630}]],"length":1761,"saved":false}
{"ts":1374378294574,"patch":[[{"diffs":[[0,"!users) "],[-1,"console.log("],[1,"{\n          res.json({error: "],[0,"\"No vend"]],"start1":1339,"start2":1339,"length1":28,"length2":45},{"diffs":[[0,"s found\""],[1,"}"],[0,");\n     "]],"start1":1386,"start2":1386,"length1":16,"length2":17},{"diffs":[[0,"    "],[-1,"else users.forEach( function(user) {\n      console.log(user);\n      } );\n    });    \n\n  userProvider.findAll(function(error, emps){\n      res.render('index', {\n            title: 'Employees',\n            employees:emps\n        });\n  });"],[1,"}\n      else\n          res.json(users);\n    });    "],[0,"\n});"]],"start1":1400,"start2":1400,"length1":244,"length2":59}]],"length":1594,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374378559387,"patch":[[{"diffs":[[0,"\"users\"]"],[1,";"],[0,"\n"],[-1,""],[0,"var db ="]],"start1":1155,"start2":1155,"length1":17,"length2":18},{"diffs":[[0,"s).db;\n\n"],[1,""],[0,"app.get("]],"start1":1214,"start2":1214,"length1":16,"length2":16},{"diffs":[[0,"es){"],[-1,"\n    db.users.find({vendor: true}, function(err, users) {\n      if( err || !users) {\n          res.json({error: \"No vendors found\"});\n      }\n      else\n          res.json(users);\n    });    \n"],[0,"});\n"]],"start1":1261,"start2":1261,"length1":200,"length2":8}]],"length":1403,"saved":false}
{"ts":1374378696047,"patch":[[{"diffs":[[0,"    "],[-1,"db.users.find({vendor: true}, function(err, users) {\n      if( err || !users) {\n          res.json({error: \"No vendors found\"});\n      }\n      else\n          res.json(users);\n    });    "],[1,"res.json(db.getVendors())"],[0,"\n});"]],"start1":1265,"start2":1265,"length1":194,"length2":33}]],"length":1433,"saved":false}
{"ts":1374378698211,"patch":[[{"diffs":[[0,"ndors())"],[1,";"],[0,"\n});\n\nht"]],"start1":1286,"start2":1286,"length1":16,"length2":17}]],"length":1434,"saved":false}
{"ts":1374378752147,"patch":[[{"diffs":[[0,"q, res){"],[1,"\n    res.json(db.getVendors());\n"],[0,"});\n\nhtt"]],"start1":1257,"start2":1257,"length1":16,"length2":48}]],"length":1435,"saved":false}
{"ts":1374378848667,"patch":[[{"diffs":[[0,"\"users\"]"],[1,";"],[0,"\nvar db "]],"start1":1155,"start2":1155,"length1":16,"length2":17},{"diffs":[[0,"ons)"],[-1,".db"],[0,";\n\na"]],"start1":1212,"start2":1212,"length1":11,"length2":8}]],"length":1432,"saved":false}
{"ts":1374378881673,"patch":[[{"diffs":[[0,"\"];\nvar "],[-1,"db"],[1,"userProvider"],[0," = new U"]],"start1":1161,"start2":1161,"length1":18,"length2":28},{"diffs":[[0,"es.json("],[-1,"db"],[1,"userProvider"],[0,".getVend"]],"start1":1278,"start2":1278,"length1":18,"length2":28}]],"length":1452,"saved":false}
{"ts":1374378952066,"patch":[[{"diffs":[[0,"Vendors());\n"],[1,"    console.log(userProvider.getVendors());\n"],[0,"});\n\nhttp.cr"]],"start1":1302,"start2":1302,"length1":24,"length2":68}]],"length":1496,"saved":false}
{"ts":1374379432410,"patch":[[{"diffs":[[0,"    "],[-1,"res.json("],[0,"user"]],"start1":1273,"start2":1273,"length1":17,"length2":8},{"diffs":[[0,"ors("],[-1,"));\n    console.log(userProvider.getVendors()"],[1,"function(results) {\n        res.json(results);\n        console.log(res.json(results));\n    }"],[0,");\n}"]],"start1":1297,"start2":1297,"length1":53,"length2":100}]],"length":1534,"saved":false}
{"ts":1374380701572,"patch":[[{"diffs":[[0,"s', "],[-1,"routes.vendors"],[1,"function (req, res) {\n    routes.vendors(req, res, userProvider);\n}"],[0,");\na"]],"start1":855,"start2":855,"length1":22,"length2":75}]],"length":1587,"saved":false}
{"ts":1374381186929,"patch":[[{"diffs":[[0,"());\n}\n\n"],[1,"// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar userProvider = new UserProvider(databaseUrl, collections);\n\n"],[0,"app.get("]],"start1":731,"start2":731,"length1":16,"length2":231},{"diffs":[[0,"\n// "],[-1,"MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar userProvider = new UserProvider(databaseUrl, collections);\n\n"],[0,"app."]],"start1":1281,"start2":1281,"length1":220,"length2":8},{"diffs":[[0,", res){\n"],[1,"// "],[0,"    user"]],"start1":1321,"start2":1321,"length1":16,"length2":19},{"diffs":[[0,"(results) {\n"],[1,"// "],[0,"        res."]],"start1":1368,"start2":1368,"length1":24,"length2":27},{"diffs":[[0,"sults);\n"],[1,"//"],[0,"        "],[1," "],[0,"console."]],"start1":1402,"start2":1402,"length1":24,"length2":27},{"diffs":[[0,"));\n"],[1,"// "],[0,"    });\n"],[1,"// "],[0,"});\n"]],"start1":1449,"start2":1449,"length1":16,"length2":22}]],"length":1605,"saved":false}
{"ts":1374381710588,"patch":[[{"diffs":[[0,"());\n}\n\n"],[1,"// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar userProvider = new UserProvider(databaseUrl, collections);\n\n"],[0,"app.get("]],"start1":731,"start2":731,"length1":16,"length2":231},{"diffs":[[0,"s', "],[-1,"routes.vendors"],[1,"function (req, res) {\n    routes.vendors(req, res, userProvider);\n}"],[0,");\na"]],"start1":1070,"start2":1070,"length1":22,"length2":75},{"diffs":[[0,");\n\n"],[-1,"// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar db = new UserProvider(databaseUrl, collections).db;\n\napp.get('/vendor_list', "],[1," app.get('/vendor_list', function(req, res){\n     userProvider.getVendors("],[0,"func"]],"start1":1278,"start2":1278,"length1":240,"length2":82},{"diffs":[[0,"(function(re"],[-1,"q, re"],[1,"sult"],[0,"s)"],[1," "],[0,"{\n"],[1,"     "],[0,"    res.json"]],"start1":1355,"start2":1355,"length1":33,"length2":38},{"diffs":[[0,"son("],[-1,"db.getVendors());\n"],[1,"results);\n         console.log(res.json(results));\n     });\n "],[0,"});\n"]],"start1":1390,"start2":1390,"length1":26,"length2":69}]],"length":1593,"saved":false}
{"ts":1374381914940,"patch":[[{"diffs":[[0,"vice);\n\n"],[1,"//"],[0," app.get"]],"start1":1274,"start2":1274,"length1":16,"length2":18},{"diffs":[[0,", res){\n"],[1,"//"],[0,"     use"]],"start1":1321,"start2":1321,"length1":16,"length2":18},{"diffs":[[0,"(results) {\n"],[1,"//"],[0,"         res"]],"start1":1368,"start2":1368,"length1":24,"length2":26},{"diffs":[[0,"sults);\n"],[1,"//"],[0,"        "]],"start1":1402,"start2":1402,"length1":16,"length2":18},{"diffs":[[0,"ults));\n"],[1,"//"],[0,"     });"]],"start1":1445,"start2":1445,"length1":16,"length2":18},{"diffs":[[0,"    });\n"],[1,"//"],[0," });\n\nht"]],"start1":1456,"start2":1456,"length1":16,"length2":18}]],"length":1605,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376831576251,"patch":[[{"diffs":[[0,"  , "],[-1,"UserProvider = require('./db').UserProvider;\n\nvar app = express();\n\n// all environments\napp.set('port', process.env.PORT || 3000);\napp.set('views', __dirname + '/views');\napp.set('view engine', 'jade');\napp.use(express.favicon(__dirname + '/public/images/favicon.ico'));\napp.use(express.logger('dev'));\napp.use(express.bodyParser());\napp.use(express.methodOverride());\napp.use(app.router);\napp.use(express.static(path.join(__dirname, 'public')));\n\n// development only\nif ('development' == app.get('env')) {\n  app.use(express.errorHandler());\n}\n\n// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar userProvider = new UserProvider(databaseUrl, collections);\n\n// MONGO DB\nvar databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\"; // \"username:password@example.com/mydb\"\nvar collections = [\"users\"];\nvar userProvider = new UserProvider(databaseUrl, collections);\n\napp.get('/', routes.index);\napp.get('/users', user.list);\n\n//app.get('/customers', function (req, res) {\n//    routes.vendors(req, res, userProvider);\n});\napp.get('/vendors', function (req, res) {\n    routes.vendors(req, res, userProvider);\n});\napp.get('/delivery', routes.delivery);\napp.get('/suggestions', routes.suggestions);\napp.get('/customerService', routes.customerService);\n\n// app.get('/vendor_list', function(req, res);{\n//     userProvider.getVendors(function(results) {\n////         res.json(results);\n////         console.log(res.json(results));\n////     });\n//// });"],[1,"passport = require('passport')\n  , LocalStrategy = require('passport-local').Strategy\n  , FacebookStrategy = require('passport-facebook').Strategy\n  //, bcrypt = require('bcrypt')\n  , mongoose = require('mongoose')\n  , Schema = mongoose.Schema;\n//  , mongooseAuth = require('mongoose-auth');\n//  , UserProvider = require('./db').UserProvider\n\nvar app = express();\n\n// MONGO DB\n\nvar UserSchema = Schema({\n    classification: { type: String, required: true },\n    email: { type: String, required: true, index: { unique: true } },\n    username: { type: String, required: true, index: { unique: true } },\n    password: { type: String, required: true },\n    salt: { type: String, required: true }\n});\n\n/*\n *\n */\nUserSchema.statics.getVendors = function (callback) {\n  return this.find({vendor: true}, function(err, users) {\n      if( err || !users) {\n          callback({error: \"No vendors found\"});\n      }\n      else {\n          callback(users);\n      }\n    });\n};\n\nvar SALT_WORK_FACTOR = 10;\nUserSchema.pre('save', function(next) {\n    var user = this;\n\n    // only hash the password if it has been modified (or is new)\n    if (!user.isModified('password')) return next();\n\n    // generate a salt\n    bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {\n        if (err) return next(err);\n\n        // hash the password using our new salt\n        bcrypt.hash(user.password, salt, function (err, hash) {\n            if (err) return next(err);\n\n            // set the hashed password back on our user document\n            user.password = hash;\n            user.salt = salt;\n            next();\n        });\n    });\n});\n\nUserSchema.methods.validatePassword = function(candidatePassword) {\n  return bcrypt.compareSync(candidatePassword, this.password);\n};\n\nvar User = mongoose.model('User', UserSchema);\n\n// Needs to be up top in order to setup database middleware (ie. app.use())\n//var databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\";\n//var collections = [\"users\"];\n//var userProvider = new UserProvider(databaseUrl, collections);\nmongoose.connect('venfu:ufnev@dharma.mongohq.com:10057/app16932282');\n\nvar db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\n\n// Passport\npassport.use(new LocalStrategy({\n    usernameField: 'username',\n    passwordField: 'password'\n  },\n  function(username, password, done) {\n    User.findOne({ username: username }, function(err, user) {\n      if (err) { \n        console.log(err);\n        return done(err); \n      }\n      if (!user) {\n        console.log({ message: 'Incorrect username.' });\n        return done(null, false, { message: 'Incorrect username.' });\n      }\n      if(!user.validatePassword(password)) {\n          console.log({ message: 'Incorrect password.' });\n          // console.log(password);\n          // console.log(user);\n          return done(null, false, { message: 'Incorrect password.' });\n      }\n      // console.log(user);\n      return done(null, user);\n    });\n  }\n));\n\n// all environments\napp.set('port', process.env.PORT || 3000);\napp.set('views', __dirname + '/views');\napp.set('view engine', 'jade');\n\n// Adds a `getUserProvider` function to each response object which gives access to the database connection\n// app.use(function(req, res, next) {\n//     res.getUserProvider = function() {\n//         return User;\n//     };\n//     next();\n// });\napp.use(express.favicon(__dirname + '/public/images/favicon.ico'));\napp.use(express.logger('dev'));\napp.use(express.bodyParser());\napp.use(express.cookieParser('mr ripley')); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(express.session({ secret: 'SECRET'})); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(express.methodOverride());\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(app.router);\napp.use(express.static(path.join(__dirname, 'public')));\n\n// development only\nif ('development' == app.get('env')) {\n  app.use(express.errorHandler());\n}\n\napp.get('/', routes.index);\n\napp.get('/users', user.list);\napp.get('/customers', routes.customers);\napp.get('/vendors', routes.vendors);\napp.get('/delivery', routes.delivery);\napp.get('/suggestions', routes.suggestions);\napp.get('/customerService', routes.customerService);\napp.get('/login', routes.login);\napp.get('/register', routes.register);\napp.get('/about', routes.about);\napp.get('/settings', routes.settings);\n\napp.get('/logout', function(req, res){\n  // console.log(\"Logging Out Now...\");\n  req.logout();\n  // console.log(req.user);\n  // console.log(req.session);\n  res.redirect('/');\n});\n\napp.post('/login',\n  passport.authenticate('local', { successRedirect: '/',\n                                   failureRedirect: '/login'})\n);\n\n// function authenticatedOrNot(req, res, next){\n//     if(req.isAuthenticated()){\n//         next();\n//     }else{\n//         res.redirect(\"/login\");\n//     }\n// }\n// \n// app.get('/user', \n//   authenticatedOrNot,\n//   // passport.authenticate('local', { failureRedirect: '/login' }),\n//   function(req, res) {\n//     console.log(req.user);\n//     res.json(req.user);\n//   }\n// );\n\n\napp.post('/register',\n  // passport.authenticate('local', { successRedirect: '/',\n    // failureRedirect: '/register'}),\n  function(req, res) {\n    console.log(req);\n    var username = req.body.username;\n    var password = req.body.password;\n    var email = req.body.email;\n\n    var user = new User({username: username, email: email, classification: \"C\", password: password, salt: \"no-salt-please\"});\n    user.save(function(err) {\n      if (err) { \n        console.log(err);\n      }\n    });\n    res.redirect('#');\n  }\n);\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findOne({_id: id}, function(err, user) {\n    done(err, user);\n  });\n});\n\n"],[0,"\n\nht"]],"start1":190,"start2":190,"length1":1563,"length2":5819}]],"length":6140,"saved":false}
{"contributors":[],"silentsave":true,"ts":1378528037921,"patch":[[{"diffs":[[0,"ategy\n  "],[-1,"//"],[1,", ConnectEnsureLogin = require('connect-ensure-login')\n  "],[0,", bcrypt"]],"start1":335,"start2":335,"length1":18,"length2":73},{"diffs":[[0,"e.Schema"],[1,"\n  , nodemailer = require('nodemailer')\n  ,flash = require('connect-flash')\n  "],[0,";\n//  , "]],"start1":484,"start2":484,"length1":16,"length2":94},{"diffs":[[0," true }\n"],[1,"    \n"],[0,"});\n\n/*\n"]],"start1":1011,"start2":1011,"length1":16,"length2":21},{"diffs":[[0,"alse"],[-1,", { message: 'Incorrect username.' });\n      }\n   "],[1,");\n      }\n      if(!user.validatePassword(password)) {\n          console.log({ err: 'Incorrect password.' });\n          // console.log(password);\n          // console.log(user);\n          return done(null, false);\n      }\n      // console.log(user);\n      return done(null, user);\n    });\n  }\n));\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n    \n    // User.findOne({ username: username }, function(err, user) {\n    //   if (err) { \n    //     console.log(err);\n    //     return done(err); \n    //   }\n    //   if (!user) {\n    //     console.log({ message: 'Incorrect username.' });\n    //     return done(null, false, { message: 'Incorrect username.' });\n    //   }\n    //"],[0,"   i"]],"start1":2938,"start2":2938,"length1":58,"length2":1289},{"diffs":[[0,"password)) {\n   "],[1," //"],[0,"       console.l"]],"start1":4252,"start2":4252,"length1":32,"length2":35},{"diffs":[[0,"ssword.' });\n   "],[1," //"],[0,"       // consol"]],"start1":4314,"start2":4314,"length1":32,"length2":35},{"diffs":[[0,"g(password);\n   "],[1," //"],[0,"       // consol"]],"start1":4353,"start2":4353,"length1":32,"length2":35},{"diffs":[[0,"e.log(user);\n   "],[1," //"],[0,"       return do"]],"start1":4388,"start2":4388,"length1":32,"length2":35},{"diffs":[[0,"rd.' });\n   "],[1," //"],[0,"   }\n   "],[1," //"],[0,"   // consol"]],"start1":4467,"start2":4467,"length1":32,"length2":38},{"diffs":[[0,".log(user);\n    "],[1,"//"],[0,"  "],[1," "],[0,"return done(null"]],"start1":4506,"start2":4506,"length1":34,"length2":37},{"diffs":[[0,", user);\n   "],[1," //"],[0," });\n  "],[-1,"}\n"],[1,"  \n    // User.findOrCreate(profile.value, function(err, user) {\n    //   if (err) { return done(err); }\n    //   done(null, user);\n    // });\n//  }\n//"],[0,"));\n\n// all "]],"start1":4543,"start2":4543,"length1":33,"length2":185},{"diffs":[[0,"SECRET'}"],[1,", { cookie: { maxAge: 60000 }}"],[0,")); // H"]],"start1":5363,"start2":5363,"length1":16,"length2":46},{"diffs":[[0,"???????????????\n"],[1,"app.use(flash());\n"],[0,"app.use(express."]],"start1":5442,"start2":5442,"length1":32,"length2":50},{"diffs":[[0,"y);\n"],[-1,"app.get('/suggestions', routes.suggestions);"],[0,""],[1,""],[0,"\napp"]],"start1":5920,"start2":5920,"length1":52,"length2":8},{"diffs":[[0,"e);\n"],[-1,"app.get('/login', routes.login);\napp.get('/register', routes.register);\n"],[0,"app."]],"start1":5974,"start2":5974,"length1":80,"length2":8},{"diffs":[[0,"tes.about);\n"],[1,"//"],[0,"app.get('/se"]],"start1":5999,"start2":5999,"length1":24,"length2":26},{"diffs":[[0,"ssion);\n"],[1,"  req.flash('info', ['See ya later.']);\n"],[0,"  res.re"]],"start1":6199,"start2":6199,"length1":16,"length2":56},{"diffs":[[0,"');\n"],[1,"  \n"],[0,"});\n\n"],[-1,"app.post('/login',\n"],[1,"// Redirect the user to Facebook for authentication.  When complete,\n// Facebook will redirect the user back to the application at\n//     /auth/facebook/callback\n//app.get('/auth/facebook', passport.authenticate('facebook'));\n\n// Facebook will redirect the user to this URL after approval.  Finish the\n// authentication process by attempting to obtain an access token.  If\n// access was granted, the user will be logged in.  Otherwise,\n// authentication has failed.\n//app.get('/auth/facebook/callback', \n//"],[0,"  pa"]],"start1":6264,"start2":6264,"length1":32,"length2":522},{"diffs":[[0,"t.authenticate('"],[-1,"local"],[1,"facebook"],[0,"', { successRedi"]],"start1":6791,"start2":6791,"length1":37,"length2":40},{"diffs":[[0,"irect: '/',\n"],[1,"//   "],[0,"            "]],"start1":6830,"start2":6830,"length1":24,"length2":29},{"diffs":[[0,": '/"],[-1,"login'})\n"],[1,"' }));\n\n// app.post('/login',\n//  passport.authenticate('local', { successRedirect: '/',\n//                                   failureRedirect: '/'})\n// "],[0,");\n\n"]],"start1":6897,"start2":6897,"length1":17,"length2":160},{"diffs":[[0," }\n// }\n"],[-1,"// "],[0,""],[1,""],[0,"\n// app."]],"start1":7213,"start2":7213,"length1":19,"length2":16},{"diffs":[[0,");\n\n"],[1,"// *** Register / Sign up ***"],[0,"\napp."],[-1,"pos"],[1,"ge"],[0,"t('/"]],"start1":7432,"start2":7432,"length1":16,"length2":44},{"diffs":[[0,"er',"],[-1,"\n  // passport.authenticate('local', { successRedirect: '/',\n    // failureRedirect: "],[1," routes.register);\napp.post("],[0,"'/re"]],"start1":7482,"start2":7482,"length1":93,"length2":36},{"diffs":[[0,"egister'"],[-1,"})"],[0,","],[1," "],[0,"\n  funct"]],"start1":7517,"start2":7517,"length1":19,"length2":18},{"diffs":[[0," res) {\n    "],[1,"//"],[0,"console.log("]],"start1":7543,"start2":7543,"length1":24,"length2":26},{"diffs":[[0,"g(req);\n"],[1,"    var email = req.body.email;\n"],[0,"    var "]],"start1":7567,"start2":7567,"length1":16,"length2":48},{"diffs":[[0,"var "],[-1,"email = req.body.email;\n"],[1,"classification = req.body.classification;\n  "],[0,"\n   "]],"start1":7687,"start2":7687,"length1":32,"length2":52},{"diffs":[[0,"w User({"],[1,"\n      "],[0,"username"]],"start1":7753,"start2":7753,"length1":16,"length2":23},{"diffs":[[0,"ername, "],[1,"\n      "],[0,"email: e"]],"start1":7780,"start2":7780,"length1":16,"length2":23},{"diffs":[[0," email, "],[1,"\n      "],[0,"classifi"]],"start1":7801,"start2":7801,"length1":16,"length2":23},{"diffs":[[0,"on: "],[-1,"\"C\","],[1,"classification, \n     "],[0," pas"]],"start1":7828,"start2":7828,"length1":12,"length2":30},{"diffs":[[0,": password, "],[1,"\n      "],[0,"salt: \"no-sa"]],"start1":7863,"start2":7863,"length1":24,"length2":31},{"diffs":[[0,"-please\"});\n"],[1,"      \n"],[0,"    user.sav"]],"start1":7896,"start2":7896,"length1":24,"length2":31},{"diffs":[[0,"    "],[-1,"}\n    });\n    res.redirect('#');\n  }\n);\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findOne({_id: id}, function(err, user) {\n    done(err, user);\n"],[1,"  req.flash('err', err);\n        res.redirect('back');\n      }\n      else {\n        // After successful Sign Up, Sign In\n        //res.redirect('back');\n        req.flash('success', ['Welcome, ' + username]);\n        passport.authenticate('local')(req, res, function () {\n          res.redirect('back');\n        });\n      }\n  });\n});\n\n// ********** LOG IN ***********\napp.get('/login', routes.login);\n// app.post('/login', passport.authenticate('local', {\n//   successReturnToOrRedirect: 'back', successFlash: true, failureRedirect: 'back', failureFlash: true\n// }));\napp.post('/login',\n  passport.authenticate('local'),\n  function(req, res) {\n    // If this function gets called, authentication was successful.\n    req.flash('success', ['Welcome, ' + req.user.username]);\n    res.redirect('back');\n  });\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findOne({_id: id}, function(err, user) {\n    done(err, user);\n  });\n});\n\n// Settings\napp.get('/settings',\n//  ensureLoggedIn('/login'),\n  function(req, res) {\n    res.render('settings', { user: req.user });\n  });\n\n// Mail and Suggestions\napp.get('/suggestions', routes.suggestions);\napp.post('/suggestions', function (req, res) {\n  var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n  //Mail options\n  mailOpts = {\n      //- from: req.body.name + ' &lt;' + req.body.email + '&gt;', //grab form data from the request body object\n      from: 'suggestions@venfu.com',\n      to: 'jarvis.martin75@gmail.com',\n      subject: 'Suggestion(s) from venfu.com',\n      text: req.body.email + ' says ' + req.body.message\n  };\n    \n    smtpTrans.sendMail(mailOpts, function (error, response) {\n\n      //Email not sent\n      if (error) {\n        req.flash('err', [error + response]); \n        res.render('suggestions', { title: \"VenFu - Suggestions\"});\n      }\n      //Yay!! Email sent\n      else {\n        req.flash('success', ['Message received.  Thank you.']);\n        res.redirect('/');\n      }\n  "],[0,"  })"]],"start1":7991,"start2":7991,"length1":238,"length2":2291}]],"length":10424,"saved":false}
{"ts":1378528950789,"patch":[[{"diffs":[[0,"index);\n"],[-1,"\n"],[0,"app.get("]],"start1":5768,"start2":5768,"length1":17,"length2":16}]],"length":10423,"saved":false}
{"ts":1378529630320,"patch":[[{"diffs":[[0,"});\n});\n"],[1,"app.po"],[0,"\n\n\nhttp."]],"start1":10279,"start2":10279,"length1":16,"length2":22}]],"length":10429,"saved":false}
{"ts":1378529631368,"patch":[[{"diffs":[[0,";\napp.po"],[1,"st()"],[0,"\n\n\nhttp."]],"start1":10285,"start2":10285,"length1":16,"length2":20}]],"length":10433,"saved":false}
{"ts":1378529634868,"patch":[[{"diffs":[[0,"pp.post("],[1,"''"],[0,")\n\n\nhttp"]],"start1":10288,"start2":10288,"length1":16,"length2":18}]],"length":10435,"saved":false}
{"ts":1378529636178,"patch":[[{"diffs":[[0,"p.post('"],[1,"/"],[0,"')\n\n\nhtt"]],"start1":10289,"start2":10289,"length1":16,"length2":17}]],"length":10436,"saved":false}
{"ts":1378529646232,"patch":[[{"diffs":[[0,".post('/"],[1,"cuec"],[0,"')\n\n\nhtt"]],"start1":10290,"start2":10290,"length1":16,"length2":20}]],"length":10440,"saved":false}
{"ts":1378529647367,"patch":[[{"diffs":[[0,"('/c"],[-1,"uec"],[0,"')\n\n"]],"start1":10295,"start2":10295,"length1":11,"length2":8}]],"length":10437,"saved":false}
{"ts":1378529649367,"patch":[[{"diffs":[[0,"post('/c"],[1,"heck"],[0,"')\n\n\nhtt"]],"start1":10291,"start2":10291,"length1":16,"length2":20}]],"length":10441,"saved":false}
{"ts":1378529651820,"patch":[[{"diffs":[[0,"('/check"],[1,"Username"],[0,"')\n\n\nhtt"]],"start1":10295,"start2":10295,"length1":16,"length2":24}]],"length":10449,"saved":false}
{"ts":1378529655865,"patch":[[{"diffs":[[0,"sername'"],[1,", check"],[0,")\n\n\nhttp"]],"start1":10304,"start2":10304,"length1":16,"length2":23}]],"length":10456,"saved":false}
{"ts":1378529658027,"patch":[[{"diffs":[[0,"', check"],[1,"."],[0,")\n\n\nhttp"]],"start1":10311,"start2":10311,"length1":16,"length2":17}]],"length":10457,"saved":false}
{"ts":1378529660388,"patch":[[{"diffs":[[0,", check."],[1,"user"],[0,")\n\n\nhttp"]],"start1":10312,"start2":10312,"length1":16,"length2":20}]],"length":10461,"saved":false}
{"ts":1378529662048,"patch":[[{"diffs":[[0," check.u"],[-1,"ser"],[0,")\n\n\nhttp"]],"start1":10313,"start2":10313,"length1":19,"length2":16}]],"length":10458,"saved":false}
{"ts":1378529663893,"patch":[[{"diffs":[[0," check.u"],[1,"nique"],[0,")\n\n\nhttp"]],"start1":10313,"start2":10313,"length1":16,"length2":21}]],"length":10463,"saved":false}
{"ts":1378529721559,"patch":[[{"diffs":[[0,"k.unique"],[1,"Uns"],[0,")\n\n\nhttp"]],"start1":10318,"start2":10318,"length1":16,"length2":19}]],"length":10466,"saved":false}
{"ts":1378529723003,"patch":[[{"diffs":[[0,"niqueUns"],[1,"er"],[0,")\n\n\nhttp"]],"start1":10321,"start2":10321,"length1":16,"length2":18}]],"length":10468,"saved":false}
{"ts":1378529724590,"patch":[[{"diffs":[[0,"queU"],[-1,"nser"],[0,")\n\n\n"]],"start1":10323,"start2":10323,"length1":12,"length2":8}]],"length":10464,"saved":false}
{"ts":1378529726159,"patch":[[{"diffs":[[0,".uniqueU"],[1,"ser"],[0,")\n\n\nhttp"]],"start1":10319,"start2":10319,"length1":16,"length2":19}]],"length":10467,"saved":false}
{"ts":1378529979956,"patch":[[{"diffs":[[0,"queUser)"],[1,";"],[0,"\n\n\nhttp."]],"start1":10323,"start2":10323,"length1":16,"length2":17}]],"length":10468,"saved":false}
{"ts":1378530331143,"patch":[[{"diffs":[[0,"e', "],[-1,"check.uniqueUser"],[1,"function(req, res){\n  var User = res.getUserProvider();\n  var username = req.body.username;\n    User.findOne({ username: username }, function(err, user) {\n      \n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err, unique: false});\n      } else if (!user) {\n        // no error with query and username was not found (it's unique)\n        console.log({ message: 'Incorrect username.' });\n        res.json({error: null, unique: true});\n      } else {\n        // no error with query and username was found (it's not unique)\n        res.json({error: null, unique: false});\n      }\n    });\n}"],[0,");\n\n"]],"start1":10310,"start2":10310,"length1":24,"length2":677}]],"length":11121,"saved":false}
{"ts":1378530467461,"patch":[[{"diffs":[[0," unique)\n       "],[1," //"],[0," console.log({ m"]],"start1":10718,"start2":10718,"length1":32,"length2":35}]],"length":11124,"saved":false}
{"ts":1378530991169,"patch":[[{"diffs":[[0,"{ message: '"],[-1,"Incorrect"],[1,"No"],[0," username.' "]],"start1":10750,"start2":10750,"length1":33,"length2":26}]],"length":11117,"saved":false}
{"ts":1378530995282,"patch":[[{"diffs":[[0,"ge: 'No username"],[1," found"],[0,".' });\n        r"]],"start1":10757,"start2":10757,"length1":32,"length2":38}]],"length":11123,"saved":false}
{"ts":1378530996333,"patch":[[{"diffs":[[0,"que)\n       "],[-1," //"],[0," console.log"]],"start1":10722,"start2":10722,"length1":27,"length2":24}]],"length":11120,"saved":false}
{"ts":1378531004962,"patch":[[{"diffs":[[0,"t's not unique)\n"],[1,"        console.log({ message: 'No username found.' });\n"],[0,"        res.json"]],"start1":10901,"start2":10901,"length1":32,"length2":88}]],"length":11176,"saved":false}
{"ts":1378531009078,"patch":[[{"diffs":[[0,"log({ message: '"],[-1,"No u"],[1,"U"],[0,"sername found.' "]],"start1":10933,"start2":10933,"length1":36,"length2":33}]],"length":11173,"saved":false}
{"ts":1378531336818,"patch":[[{"diffs":[[0,"nection\n"],[-1,"// "],[0,"app.use("]],"start1":4956,"start2":4956,"length1":19,"length2":16},{"diffs":[[0,"next) {\n"],[-1,"//"],[0,"    "],[-1," "],[0,"res.getU"]],"start1":4991,"start2":4991,"length1":23,"length2":20},{"diffs":[[0,"unction() {\n"],[-1,"// "],[0,"        retu"]],"start1":5026,"start2":5026,"length1":27,"length2":24},{"diffs":[[0,"er;\n"],[-1,"// "],[0,"    };\n"],[-1,"//"],[0,"    "],[-1," "],[0,"next();\n"],[-1,"// "],[0,"});\n"]],"start1":5055,"start2":5055,"length1":36,"length2":27}]],"length":11155,"saved":false}
{"ts":1378533219221,"patch":[[{"diffs":[[0,"ername;\n"],[-1,"  "],[0,"  User.f"]],"start1":10380,"start2":10380,"length1":18,"length2":16}]],"length":11153,"saved":false}
{"ts":1378533221926,"patch":[[{"diffs":[[0,"user) {\n"],[-1,"      "],[0,"\n      /"]],"start1":10441,"start2":10441,"length1":22,"length2":16}]],"length":11147,"saved":false}
{"ts":1378533222440,"patch":[[{"diffs":[[0,"rr, user) {\n"],[-1,"\n"],[0,"      // err"]],"start1":10437,"start2":10437,"length1":25,"length2":24}]],"length":11146,"saved":false}
{"ts":1378533341383,"patch":[[{"diffs":[[0," User.findOne({ "],[1,"'"],[0,"username: userna"]],"start1":10389,"start2":10389,"length1":32,"length2":33}]],"length":11147,"saved":false}
{"ts":1378533342985,"patch":[[{"diffs":[[0,"dOne({ 'username"],[1,"'"],[0,": username }, fu"]],"start1":10398,"start2":10398,"length1":32,"length2":33}]],"length":11148,"saved":false}
{"ts":1378533583224,"patch":[[{"diffs":[[0,"username found.'"],[1," + "],[0," });\n        res"]],"start1":10737,"start2":10737,"length1":32,"length2":35}]],"length":11151,"saved":false}
{"ts":1378533585643,"patch":[[{"diffs":[[0,"und.' + "],[1,"user"],[0," });\n   "]],"start1":10748,"start2":10748,"length1":16,"length2":20}]],"length":11155,"saved":false}
{"ts":1378533587375,"patch":[[{"diffs":[[0,"und.' + user"],[1,"name"],[0," });\n       "]],"start1":10748,"start2":10748,"length1":24,"length2":28}]],"length":11159,"saved":false}
{"ts":1378533698396,"patch":[[{"diffs":[[0,"me found"],[-1,"."],[1,":"],[0,"' + user"]],"start1":10743,"start2":10743,"length1":17,"length2":17}]],"length":11159,"saved":false}
{"ts":1378533698966,"patch":[[{"diffs":[[0,"e found:"],[1," "],[0,"' + user"]],"start1":10744,"start2":10744,"length1":16,"length2":17}]],"length":11160,"saved":false}
{"ts":1378533869202,"patch":[[{"diffs":[[0,"ername;\n"],[1,"  \n"],[0,"  User.f"]],"start1":10380,"start2":10380,"length1":16,"length2":19}]],"length":11163,"saved":false}
{"ts":1378533870902,"patch":[[{"diffs":[[0,"name;\n  "],[1,"if "],[0,"\n  User."]],"start1":10382,"start2":10382,"length1":16,"length2":19}]],"length":11166,"saved":false}
{"ts":1378533873080,"patch":[[{"diffs":[[0,"me;\n  if"],[-1," "],[1,"()"],[0,"\n  User."]],"start1":10384,"start2":10384,"length1":17,"length2":18}]],"length":11167,"saved":false}
{"ts":1378533877655,"patch":[[{"diffs":[[0,"e;\n  if("],[1,"unsername "],[0,")\n  User"]],"start1":10385,"start2":10385,"length1":16,"length2":26}]],"length":11177,"saved":false}
{"ts":1378533878653,"patch":[[{"diffs":[[0,"sername "],[1,"==u"],[0,")\n  User"]],"start1":10395,"start2":10395,"length1":16,"length2":19}]],"length":11180,"saved":false}
{"ts":1378533881827,"patch":[[{"diffs":[[0,"name ==u"],[1,"ndefined"],[0,")\n  User"]],"start1":10398,"start2":10398,"length1":16,"length2":24}]],"length":11188,"saved":false}
{"ts":1378533884916,"patch":[[{"diffs":[[0,"rname =="],[1," "],[0,"undefine"]],"start1":10397,"start2":10397,"length1":16,"length2":17},{"diffs":[[0,"defined)"],[1," "],[0,"\n  User."]],"start1":10408,"start2":10408,"length1":16,"length2":17}]],"length":11190,"saved":false}
{"ts":1378533886990,"patch":[[{"diffs":[[0,"efined) "],[1,"{\n    \n  }"],[0,"\n  User."]],"start1":10409,"start2":10409,"length1":16,"length2":26}]],"length":11200,"saved":false}
{"ts":1378533890752,"patch":[[{"diffs":[[0,";\n  if(u"],[-1,"n"],[0,"sername "]],"start1":10386,"start2":10386,"length1":17,"length2":16}]],"length":11199,"saved":false}
{"ts":1378533906940,"patch":[[{"diffs":[[0,"ndefined) {\n"],[1,"    res.json({error: null, unique: false});\n"],[0,"    \n  }\n  U"]],"start1":10406,"start2":10406,"length1":24,"length2":68}]],"length":11243,"saved":false}
{"ts":1378533907511,"patch":[[{"diffs":[[0,"});\n    "],[1,"re"],[0,"\n  }\n  U"]],"start1":10458,"start2":10458,"length1":16,"length2":18}]],"length":11245,"saved":false}
{"ts":1378533908885,"patch":[[{"diffs":[[0,";\n    re"],[1,"turn"],[0,"\n  }\n  U"]],"start1":10460,"start2":10460,"length1":16,"length2":20}]],"length":11249,"saved":false}
{"ts":1378533910020,"patch":[[{"diffs":[[0,"  return"],[1,";"],[0,"\n  }\n  U"]],"start1":10464,"start2":10464,"length1":16,"length2":17}]],"length":11250,"saved":false}
{"ts":1378533950529,"patch":[[{"diffs":[[0,"ername;\n"],[1,"  console.log(err);\n"],[0,"  if(use"]],"start1":10380,"start2":10380,"length1":16,"length2":36}]],"length":11270,"saved":false}
{"ts":1378533953743,"patch":[[{"diffs":[[0,"console.log("],[-1,"er"],[0,"r"],[1,"e"],[0,");\n  if(user"]],"start1":10390,"start2":10390,"length1":27,"length2":26}]],"length":11269,"saved":false}
{"ts":1378533955065,"patch":[[{"diffs":[[0,"e.log(re"],[1,"q"],[0,");\n  if("]],"start1":10396,"start2":10396,"length1":16,"length2":17}]],"length":11270,"saved":false}
{"ts":1378533956051,"patch":[[{"diffs":[[0,"sole.log(req"],[1,".b"],[0,");\n  if(user"]],"start1":10393,"start2":10393,"length1":24,"length2":26}]],"length":11272,"saved":false}
{"ts":1378533958093,"patch":[[{"diffs":[[0,"og(req.b"],[1,"ody"],[0,");\n  if("]],"start1":10399,"start2":10399,"length1":16,"length2":19}]],"length":11275,"saved":false}
{"ts":1378534770966,"patch":[[{"diffs":[[0,"rname =="],[1,"="],[0," undefin"]],"start1":10421,"start2":10421,"length1":16,"length2":17}]],"length":11276,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378535466017,"patch":[[{"diffs":[[0,"e: false});\n"],[1,"        req.flash('err', ['Error. VenFu masters are seeking a solution...'])\n"],[0,"      } else"]],"start1":10708,"start2":10708,"length1":24,"length2":101}]],"length":11353,"saved":false}
{"ts":1378535856385,"patch":[[{"diffs":[[0,"name;\n  "],[1,"//"],[0,"console."]],"start1":10382,"start2":10382,"length1":16,"length2":18},{"diffs":[[0,"on...'])"],[1,";"],[0,"\n      }"]],"start1":10790,"start2":10790,"length1":16,"length2":17},{"diffs":[[0,"unique)\n        "],[1,"//"],[0,"console.log({ me"]],"start1":10890,"start2":10890,"length1":32,"length2":34},{"diffs":[[0,"unique)\n        "],[1,"//"],[0,"console.log({ me"]],"start1":11094,"start2":11094,"length1":32,"length2":34}]],"length":11360,"saved":false}
{"contributors":[],"silentsave":true,"ts":1379132944233,"patch":[[{"diffs":[[0,"\n"],[-1,"/**\n * Module dependencies.\n */\n\nvar express = require('express')\n  , routes = require('./routes')\n  , user = require('./routes/user')\n  , http = require('http')\n  , path = require('path')\n  , passport = require('passport')\n  , LocalStrategy = require('passport-local').Strategy\n  , FacebookStrategy = require('passport-facebook').Strategy\n  , ConnectEnsureLogin = require('connect-ensure-login')\n  , bcrypt = require('bcrypt')\n  , mongoose = require('mongoose')\n  , Schema = mongoose.Schema\n  , nodemailer = require('nodemailer')\n  ,flash = require('connect-flash')\n  ;\n//  , mongooseAuth = require('mongoose-auth');\n//  , UserProvider = require('./db').UserProvider\n\nvar app = express();\n\n// MONGO DB\n\nvar UserSchema = Schema({\n    classification: { type: String, required: true },\n    email: { type: String, required: true, index: { unique: true } },\n    username: { type: String, required: true, index: { unique: true } },\n    password: { type: String, required: true },\n    salt: { type: String, required: true }\n    \n});\n\n/*\n *\n */\nUserSchema.statics.getVendors = function (callback) {\n  return this.find({vendor: true}, function(err, users) {\n      if( err || !users) {\n          callback({error: \"No vendors found\"});\n      }\n      else {\n          callback(users);\n      }\n    });\n};\n\nvar SALT_WORK_FACTOR = 10;\nUserSchema.pre('save', function(next) {\n    var user = this;\n\n    // only hash the password if it has been modified (or is new)\n    if (!user.isModified('password')) return next();\n\n    // generate a salt\n    bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {\n        if (err) return next(err);\n\n        // hash the password using our new salt\n        bcrypt.hash(user.password, salt, function (err, hash) {\n            if (err) return next(err);\n\n            // set the hashed password back on our user document\n            user.password = hash;\n            user.salt = salt;\n            next();\n        });\n    });\n});\n\nUserSchema.methods.validatePassword = function(candidatePassword) {\n  return bcrypt.compareSync(candidatePassword, this.password);\n};\n\nvar User = mongoose.model('User', UserSchema);\n\n// Needs to be up top in order to setup database middleware (ie. app.use())\n//var databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\";\n//var collections = [\"users\"];\n//var userProvider = new UserProvider(databaseUrl, collections);\nmongoose.connect('venfu:ufnev@dharma.mongohq.com:10057/app16932282');\n\nvar db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\n\n// Passport\npassport.use(new LocalStrategy({\n    usernameField: 'username',\n    passwordField: 'password'\n  },\n  function(username, password, done) {\n    User.findOne({ username: username }, function(err, user) {\n      if (err) { \n        console.log(err);\n        return done(err); \n      }\n      if (!user) {\n        console.log({ message: 'Incorrect username.' });\n        return done(null, false);\n      }\n      if(!user.validatePassword(password)) {\n          console.log({ err: 'Incorrect password.' });\n          // console.log(password);\n          // console.log(user);\n          return done(null, false);\n      }\n      // console.log(user);\n      return done(null, user);\n    });\n  }\n));\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n    \n    // User.findOne({ username: username }, function(err, user) {\n    //   if (err) { \n    //     console.log(err);\n    //     return done(err); \n    //   }\n    //   if (!user) {\n    //     console.log({ message: 'Incorrect username.' });\n    //     return done(null, false, { message: 'Incorrect username.' });\n    //   }\n    //   if(!user.validatePassword(password)) {\n    //       console.log({ message: 'Incorrect password.' });\n    //       // console.log(password);\n    //       // console.log(user);\n    //       return done(null, false, { message: 'Incorrect password.' });\n    //   }\n    //   // console.log(user);\n    //   return done(null, user);\n    // });\n    \n    // User.findOrCreate(profile.value, function(err, user) {\n    //   if (err) { return done(err); }\n    //   done(null, user);\n    // });\n//  }\n//));\n\n// all environments\napp.set('port', process.env.PORT || 3000);\napp.set('views', __dirname + '/views');\napp.set('view engine', 'jade');\n\n// Adds a `getUserProvider` function to each response object which gives access to the database connection\napp.use(function(req, res, next) {\n    res.getUserProvider = function() {\n        return User;\n    };\n    next();\n});\napp.use(express.favicon(__dirname + '/public/images/favicon.ico'));\napp.use(express.logger('dev'));\napp.use(express.bodyParser());\napp.use(express.cookieParser('mr ripley')); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(express.session({ secret: 'SECRET'}, { cookie: { maxAge: 60000 }})); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(flash());\napp.use(express.methodOverride());\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(app.router);\napp.use(express.static(path.join(__dirname, 'public')));\n\n// development only\nif ('development' == app.get('env')) {\n  app.use(express.errorHandler());\n}\n\napp.get('/', routes.index);\napp.get('/users', user.list);\napp.get('/customers', routes.customers);\napp.get('/vendors', routes.vendors);\napp.get('/delivery', routes.delivery);\n\napp.get('/customerService', routes.customerService);\napp.get('/about', routes.about);\n//app.get('/settings', routes.settings);\n\napp.get('/logout', function(req, res){\n  // console.log(\"Logging Out Now...\");\n  req.logout();\n  // console.log(req.user);\n  // console.log(req.session);\n  req.flash('info', ['See ya later.']);\n  res.redirect('/');\n  \n});\n\n// Redirect the user to Facebook for authentication.  When complete,\n// Facebook will redirect the user back to the application at\n//     /auth/facebook/callback\n//app.get('/auth/facebook', passport.authenticate('facebook'));\n\n// Facebook will redirect the user to this URL after approval.  Finish the\n// authentication process by attempting to obtain an access token.  If\n// access was granted, the user will be logged in.  Otherwise,\n// authentication has failed.\n//app.get('/auth/facebook/callback', \n//  passport.authenticate('facebook', { successRedirect: '/',\n//                                      failureRedirect: '/' }));\n\n// app.post('/login',\n//  passport.authenticate('local', { successRedirect: '/',\n//                                   failureRedirect: '/'})\n// );\n\n// function authenticatedOrNot(req, res, next){\n//     if(req.isAuthenticated()){\n//         next();\n//     }else{\n//         res.redirect(\"/login\");\n//     }\n// }\n\n// app.get('/user', \n//   authenticatedOrNot,\n//   // passport.authenticate('local', { failureRedirect: '/login' }),\n//   function(req, res) {\n//     console.log(req.user);\n//     res.json(req.user);\n//   }\n// );\n\n// *** Register / Sign up ***\napp.get('/register', routes.register);\napp.post('/register', \n  function(req, res) {\n    //console.log(req);\n    var email = req.body.email;\n    var username = req.body.username;\n    var password = req.body.password;\n    var classification = req.body.classification;\n  \n    var user = new User({\n      username: username, \n      email: email, \n      classification: classification, \n      password: password, \n      salt: \"no-salt-please\"});\n      \n    user.save(function(err) {\n      if (err) { \n        console.log(err);\n        req.flash('err', err);\n        res.redirect('back');\n      }\n      else {\n        // After successful Sign Up, Sign In\n        //res.redirect('back');\n        req.flash('success', ['Welcome, ' + username]);\n        passport.authenticate('local')(req, res, function () {\n          res.redirect('back');\n        });\n      }\n  });\n});\n\n// ********** LOG IN ***********\napp.get('/login', routes.login);\n// app.post('/login', passport.authenticate('local', {\n//   successReturnToOrRedirect: 'back', successFlash: true, failureRedirect: 'back', failureFlash: true\n// }));\napp.post('/login',\n  passport.authenticate('local'),\n  function(req, res) {\n    // If this function gets called, authentication was successful.\n    req.flash('success', ['Welcome, ' + req.user.username]);\n    res.redirect('back');\n  });\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findOne({_id: id}, function(err, user) {\n    done(err, user);\n  });\n});\n\n// Settings\napp.get('/settings',\n//  ensureLoggedIn('/login'),\n  function(req, res) {\n    res.render('settings', { user: req.user });\n  });\n\n// Mail and Suggestions\napp.get('/suggestions', routes.suggestions);\napp.post('/suggestions', function (req, res) {\n  var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n  //Mail options\n  mailOpts = {\n      //- from: req.body.name + ' &lt;' + req.body.email + '&gt;', //grab form data from the request body object\n      from: 'suggestions@venfu.com',\n      to: 'jarvis.martin75@gmail.com',\n      subject: 'Suggestion(s) from venfu.com',\n      text: req.body.email + ' says ' + req.body.message\n  };\n    \n    smtpTrans.sendMail(mailOpts, function (error, response) {\n\n      //Email not sent\n      if (error) {\n        req.flash('err', [error + response]); \n        res.render('suggestions', { title: \"VenFu - Suggestions\"});\n      }\n      //Yay!! Email sent\n      else {\n        req.flash('success', ['Message received.  Thank you.']);\n        res.redirect('/');\n      }\n    });\n});\napp.post('/checkUsername', function(req, res){\n  var User = res.getUserProvider();\n  var username = req.body.username;\n  //console.log(req.body);\n  if(username === undefined) {\n    res.json({error: null, unique: false});\n    return;\n  }\n  User.findOne({ 'username': username }, function(err, user) {\n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err, unique: false});\n        req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n      } else if (!user) {\n        // no error with query and username was not found (it's unique)\n        //console.log({ message: 'No username found: ' + username });\n        res.json({error: null, unique: true});\n      } else {\n        // no error with query and username was found (it's not unique)\n        //console.log({ message: 'Username found.' });\n        res.json({error: null, unique: false});\n      }\n    });\n});\n\n\nhttp.createServer(app).listen(app.get('port'), function(){\n  console.log('Express server listening on port ' + app.get('port'));\n});\n"]],"start1":0,"start2":0,"length1":11360,"length2":1}]],"length":1,"saved":false}
{"ts":1379132945540,"patch":[[{"diffs":[[-1,"\n"]],"start1":0,"start2":0,"length1":1,"length2":0}]],"length":0,"saved":false}
{"contributors":[],"silentsave":false,"ts":1379133738876,"patch":[[{"diffs":[[1,"\n/**\n * Module dependencies.\n */\n\nvar express = require('express')\n  , routes = require('./routes')\n  , user = require('./routes/user')\n  , http = require('http')\n  , path = require('path')\n  , passport = require('passport')\n  , LocalStrategy = require('passport-local').Strategy\n  , FacebookStrategy = require('passport-facebook').Strategy\n  , ConnectEnsureLogin = require('connect-ensure-login')\n  , bcrypt = require('bcrypt')\n  , mongoose = require('mongoose')\n  , Schema = mongoose.Schema\n  , nodemailer = require('nodemailer')\n  ,flash = require('connect-flash')\n  ;\n//  , mongooseAuth = require('mongoose-auth');\n//  , UserProvider = require('./db').UserProvider\n\nvar app = express();\n\n// MONGO DB\n\nvar UserSchema = Schema({\n    classification: { type: String, required: true },\n    email: { type: String, required: true, index: { unique: true } },\n    username: { type: String, required: true, index: { unique: true } },\n    password: { type: String, required: true },\n    salt: { type: String, required: true }\n    \n});\n\n/*\n *\n */\nUserSchema.statics.getVendors = function (callback) {\n  return this.find({vendor: true}, function(err, users) {\n      if( err || !users) {\n          callback({error: \"No vendors found\"});\n      }\n      else {\n          callback(users);\n      }\n    });\n};\n\nvar SALT_WORK_FACTOR = 10;\nUserSchema.pre('save', function(next) {\n    var user = this;\n\n    // only hash the password if it has been modified (or is new)\n    if (!user.isModified('password')) return next();\n\n    // generate a salt\n    bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {\n        if (err) return next(err);\n\n        // hash the password using our new salt\n        bcrypt.hash(user.password, salt, function (err, hash) {\n            if (err) return next(err);\n\n            // set the hashed password back on our user document\n            user.password = hash;\n            user.salt = salt;\n            next();\n        });\n    });\n});\n\nUserSchema.methods.validatePassword = function(candidatePassword) {\n  return bcrypt.compareSync(candidatePassword, this.password);\n};\n\nvar User = mongoose.model('User', UserSchema);\n\n// Needs to be up top in order to setup database middleware (ie. app.use())\n//var databaseUrl = \"venfu:ufnev@dharma.mongohq.com:10057/app16932282\";\n//var collections = [\"users\"];\n//var userProvider = new UserProvider(databaseUrl, collections);\nmongoose.connect('venfu:ufnev@dharma.mongohq.com:10057/app16932282');\n\nvar db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\n\n// Passport\npassport.use(new LocalStrategy({\n    usernameField: 'username',\n    passwordField: 'password'\n  },\n  function(username, password, done) {\n    User.findOne({ username: username }, function(err, user) {\n      if (err) { \n        console.log(err);\n        return done(err); \n      }\n      if (!user) {\n        console.log({ err: 'Incorrect username.' });\n        return done(null, false);\n      }\n      if(!user.validatePassword(password)) {\n          console.log({ err: 'Incorrect password.' });\n          // console.log(password);\n          // console.log(user);\n          return done(null, false);\n      }\n      // console.log(user);\n      return done(null, user);\n    });\n  }\n));\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findOne({_id: id}, function(err, user) {\n    done(err, user);\n  });\n});\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n// passport.use(new FacebookStrategy({\n//     clientID: 568769829839972,\n//     clientSecret: \"d259c829db17890a5b543ac1eb5e2383\",\n//     callbackURL: \"http://venfu.jarvism.c9.io/auth/facebook/callback\"\n//   },\n//   function(accessToken, refreshToken, profile, done) {\n//     console.log(profile);\n//     done(null, false);\n\n    \n    // User.findOne({ username: username }, function(err, user) {\n    //   if (err) { \n    //     console.log(err);\n    //     return done(err); \n    //   }\n    //   if (!user) {\n    //     console.log({ message: 'Incorrect username.' });\n    //     return done(null, false, { message: 'Incorrect username.' });\n    //   }\n    //   if(!user.validatePassword(password)) {\n    //       console.log({ message: 'Incorrect password.' });\n    //       // console.log(password);\n    //       // console.log(user);\n    //       return done(null, false, { message: 'Incorrect password.' });\n    //   }\n    //   // console.log(user);\n    //   return done(null, user);\n    // });\n    \n    // User.findOrCreate(profile.value, function(err, user) {\n    //   if (err) { return done(err); }\n    //   done(null, user);\n    // });\n//  }\n//));\n\n// all environments\napp.set('port', process.env.PORT || 3000);\napp.set('views', __dirname + '/views');\napp.set('view engine', 'jade');\n\n// Adds a `getUserProvider` function to each response object which gives access to the database connection\napp.use(function(req, res, next) {\n    res.getUserProvider = function() {\n        return User;\n    };\n    next();\n});\napp.use(express.favicon(__dirname + '/public/images/favicon.ico'));\napp.use(express.logger('dev'));\napp.use(express.bodyParser());\napp.use(express.cookieParser('mr ripley')); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(express.session({ secret: 'SECRET'}, { cookie: { maxAge: 60000 }})); // HOW DO WE NEED TO CHANGE THIS ???????????????????\napp.use(flash());\napp.use(express.methodOverride());\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(app.router);\napp.use(express.static(path.join(__dirname, 'public')));\n\n// development only\nif ('development' == app.get('env')) {\n  app.use(express.errorHandler());\n}\n\napp.get('/', routes.index);\napp.get('/users', user.list);\napp.get('/customers', routes.customers);\napp.get('/vendors', routes.vendors);\napp.get('/delivery', routes.delivery);\n\napp.get('/customerService', routes.customerService);\napp.get('/about', routes.about);\n//app.get('/settings', routes.settings);\n\napp.get('/logout', function(req, res){\n  // console.log(\"Logging Out Now...\");\n  req.logout();\n  // console.log(req.user);\n  // console.log(req.session);\n  req.flash('info', ['See ya later.']);\n  res.redirect('/');\n  \n});\n\n// Redirect the user to Facebook for authentication.  When complete,\n// Facebook will redirect the user back to the application at\n//     /auth/facebook/callback\n//app.get('/auth/facebook', passport.authenticate('facebook'));\n\n// Facebook will redirect the user to this URL after approval.  Finish the\n// authentication process by attempting to obtain an access token.  If\n// access was granted, the user will be logged in.  Otherwise,\n// authentication has failed.\n//app.get('/auth/facebook/callback', \n//  passport.authenticate('facebook', { successRedirect: '/',\n//                                      failureRedirect: '/' }));\n\n// app.post('/login',\n//  passport.authenticate('local', { successRedirect: '/',\n//                                   failureRedirect: '/'})\n// );\n\n// function authenticatedOrNot(req, res, next){\n//     if(req.isAuthenticated()){\n//         next();\n//     }else{\n//         res.redirect(\"/login\");\n//     }\n// }\n\n// app.get('/user', \n//   authenticatedOrNot,\n//   // passport.authenticate('local', { failureRedirect: '/login' }),\n//   function(req, res) {\n//     console.log(req.user);\n//     res.json(req.user);\n//   }\n// );\n\n// *** Register / Sign up ***\napp.get('/register', routes.register);\napp.post('/register', \n  function(req, res) {\n    //console.log(req);\n    var email = req.body.email;\n    var username = req.body.username;\n    var password = req.body.password;\n    var classification = req.body.classification;\n  \n    var user = new User({\n      username: username, \n      email: email, \n      classification: classification, \n      password: password, \n      salt: \"no-salt-please\"});\n      \n    user.save(function(err) {\n      if (err) { \n        console.log(err);\n        req.flash('err', err);\n        res.redirect('back');\n      }\n      else {\n        // After successful Sign Up, Sign In\n        //res.redirect('back');\n        req.flash('success', ['Welcome, ' + username]);\n        passport.authenticate('local')(req, res, function () {\n          res.redirect('back');\n        });\n      }\n  });\n});\n\n// ********** LOG IN ***********\n\napp.get('/login', routes.login);\napp.post('/login', function(req, res, next) {\n  passport.authenticate('local', function(err, user, info) {\n    if (err) { return next(err); }\n    if (!user) { return (req.flash('err', ['Incorrect Password and/or Username']) && res.redirect('back')); }\n    req.logIn(user, function(err) {\n      if (err) { return req.flash('err', ['Something went wrong.  Please log in again.']); }\n      return (req.flash('success', ['Welcome, ' + user.username]) && res.redirect('back'));\n    });\n  })(req, res, next);\n});\n\napp.post('/ajaxLogin', function(req, res, next) {\n  var User = res.getUserProvider();\n  var username = req.body.username; // ???\n  var password = req.body.password; // ???\n  console.log(req.body);\n  if(password === undefined || username === undefined) {\n    req.flash({error: 'Please enter a username and password'});\n    return;\n  }\n  User.findOne({ 'username': username }, function(err, user) {\n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err});\n        // req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n        // next(err); ??\n      } else if (!user) {\n        // no error with query and password was not found (it's unique)\n        res.json({error: 'Incorrect username'});\n        console.log({error: 'Incorrect username'});\n      } else {\n        if(!user.validatePassword(password)) {\n            console.log({ error: 'Incorrect password.' });\n            // console.log(password);\n            // console.log(user);\n            // return done(null, false);\n            res.json({error: 'Incorrect password'});\n        } else {\n          req.logIn(user, function(err) {\n            if (err) {\n              res.json({error: 'Something went wrong.  Please log in again.'});\n              console.log({error: 'Something went wrong.  Please log in again.'});\n            }\n            console.log({error: null, success: true});\n            res.json({error: null});\n          });\n        }\n      }\n    });\n});\n\n// app.post('/login', passport.authenticate('local', {\n//   successReturnToOrRedirect: 'back', failureRedirect: 'back'\n// }));\n\n// app.post('/login',\n//   passport.authenticate('local'),\n//   function(req, res, err) {\n//     if (err){\n//       req.flash('err', [err]);\n//       res.redirect('back');\n//     }\n//     else {\n//       // If this function gets called, authentication was successful.\n//       req.flash('success', ['Welcome, ' + req.user.username]);\n//       res.redirect('back');\n//     }\n//   });\n\n\n// Settings\napp.get('/settings',\n//  ensureLoggedIn('/login'),\n  function(req, res) {\n    res.render('settings', { user: req.user });\n  });\n\n// Suggestions\napp.get('/suggestions', routes.suggestions);\napp.post('/suggestions', function (req, res) {\n  var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n  //Mail options\n  mailOpts = {\n      //- from: req.body.name + ' &lt;' + req.body.email + '&gt;', //grab form data from the request body object\n      from: 'suggestions@venfu.com',\n      to: 'jarvis.martin75@gmail.com',\n      subject: 'Suggestion(s) from venfu.com',\n      text: req.body.email + ' says ' + req.body.message\n  };\n    \n    smtpTrans.sendMail(mailOpts, function (error, response) {\n\n      //Email not sent\n      if (error) {\n        req.flash('err', [error + response]); \n        res.render('suggestions', { title: \"VenFu - Suggestions\"});\n      }\n      //Yay!! Email sent\n      else {\n        req.flash('success', ['Message received.  Thank you.']);\n        res.redirect('/');\n      }\n    });\n});\n\n// Forgot Password\napp.get('/forgotPassword', routes.suggestions); //<-- Is this really necessary?\napp.post('/forgotPassword', function (req, res) {\n  var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n  //Mail options\n  mailOpts = {\n      //- from: req.body.name + ' &lt;' + req.body.email + '&gt;', //grab form data from the request body object\n      from: 'DoNotReply@venfu.com',\n      to: req.body.email,\n      subject: 'Forgot Password from venfu.com',\n      text: 'Greetings, ' + req.body.username\n  };\n    \n    smtpTrans.sendMail(mailOpts, function (error, response) {\n\n      //Email not sent\n      if (error) {\n        req.flash('err', [error + response]); \n        res.render('suggestions', { title: \"VenFu - Suggestions\"});\n      }\n      //Yay!! Email sent\n      else {\n        req.flash('success', ['Please check your email.']);\n        res.redirect('/');\n      }\n    });\n});\n\n// CHECK EMAIL IN REGISTRATION FORM\napp.post('/checkEmail', function(req, res){\n  var User = res.getUserProvider();\n  var email = req.body.email;\n  //console.log(req.body);\n  if(email === undefined) {\n    res.json({error: null, unique: false});\n    return;\n  }\n  User.findOne({ 'email': email }, function(err, user) {\n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err, unique: false});\n        req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n      } else if (!user) {\n        // no error with query and username was not found (it's unique)\n        //console.log({ message: 'No username found: ' + username });\n        res.json({error: null, unique: true});\n      } else {\n        // no error with query and username was found (it's not unique)\n        //console.log({ message: 'Username found.' });\n        res.json({error: null, unique: false});\n      }\n    });\n});\n\n// CHECK USERNAME \napp.post('/checkUsername', function(req, res){\n  var User = res.getUserProvider();\n  var username = req.body.username;\n  //console.log(req.body);\n  if(username === undefined) {\n    res.json({error: null, unique: false});\n    return;\n  }\n  User.findOne({ 'username': username }, function(err, user) {\n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err, unique: false});\n        req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n      } else if (!user) {\n        // no error with query and username was not found (it's unique)\n        //console.log({ message: 'No username found: ' + username });\n        res.json({error: null, unique: true});\n      } else {\n        // no error with query and username was found (it's not unique)\n        //console.log({ message: 'Username found.' });\n        res.json({error: null, unique: false});\n      }\n    });\n});\n\n// CHECK LOGIN PASSWORD \napp.post('/checkPassword', function(req, res){\n  var User = res.getUserProvider();\n  var password = req.body.password; // ???\n  //console.log(req.body);\n  if(password === undefined) {\n    res.json({error: null, unique: false});\n    return;\n  }\n  User.findOne({ 'password': password }, function(err, user) {\n      // error with query (return error and false for unique)\n      if (err) { \n        console.log(err);\n        res.json({error: err, unique: false});\n        req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n      } else if (!user) {\n        // no error with query and password was not found (it's unique)\n        //console.log({ message: 'Unrecognized Password: ' + password });\n        res.json({error: null, unique: true});\n      } else {\n        // no error with query and password was found (it's not unique)\n        //console.log({ message: 'Password found.' });\n        res.json({error: null, unique: false});\n      }\n    });\n});\n\nhttp.createServer(app).listen(app.get('port'), function(){\n  console.log('Express server listening on port ' + app.get('port'));\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":16626}]],"length":16626,"saved":false}
{"ts":1379134345988,"patch":[[{"diffs":[[0,"q.flash("],[-1,"{error: "],[1,"'err', ["],[0,"'Please "]],"start1":9342,"start2":9342,"length1":24,"length2":24},{"diffs":[[0,"enter a "],[-1,"u"],[1,"U"],[0,"sername "]],"start1":9366,"start2":9366,"length1":17,"length2":17},{"diffs":[[0,"ame and "],[-1,"p"],[1,"P"],[0,"assword'"],[-1,"}"],[1,"]"],[0,");\n    r"]],"start1":9379,"start2":9379,"length1":26,"length2":26},{"diffs":[[0,"g(err);\n        "],[1,"//"],[0,"res.json({error:"]],"start1":9577,"start2":9577,"length1":32,"length2":34},{"diffs":[[0,"\n       "],[-1," //"],[0," req.fla"]],"start1":9618,"start2":9618,"length1":19,"length2":16},{"diffs":[[0,"    "],[-1,"// next(err); ??"],[1,"return;"],[0,"\n   "]],"start1":9701,"start2":9701,"length1":24,"length2":15},{"diffs":[[0,"h query and "],[-1,"password"],[1,"user"],[0," was not fou"]],"start1":9762,"start2":9762,"length1":32,"length2":28},{"diffs":[[0,"unique)\n        "],[1,"//"],[0,"res.json({error:"]],"start1":9799,"start2":9799,"length1":32,"length2":34},{"diffs":[[0,"sername'});\n"],[1,"        req.flash('err', ['Unknown Username']);\n"],[0,"      } else"]],"start1":9898,"start2":9898,"length1":24,"length2":72},{"diffs":[[0,"e);\n            "],[1,"//"],[0,"res.json({error:"]],"start1":10188,"start2":10188,"length1":32,"length2":34},{"diffs":[[0,"assword'});\n"],[1,"            req.flash('err', ['Incorrect Password']);\n"],[0,"        } el"]],"start1":10235,"start2":10235,"length1":24,"length2":78},{"diffs":[[0,"{\n              "],[1,"//"],[0,"res.json({error:"]],"start1":10381,"start2":10381,"length1":32,"length2":34},{"diffs":[[0,"g in again.'});\n"],[1,"              req.flash('err', ['Something went wrong.  Please log in again.']);\n"],[0,"            }\n  "]],"start1":10532,"start2":10532,"length1":32,"length2":113},{"diffs":[[0,"});\n            "],[1,"//"],[0,"res.json({error:"]],"start1":10694,"start2":10694,"length1":32,"length2":34},{"diffs":[[0,"or: null});\n"],[1,"            req.flash('success', ['Welcome, ' +  username]);\n"],[0,"          })"]],"start1":10725,"start2":10725,"length1":24,"length2":85}]],"length":16864,"saved":false}
{"ts":1379135801251,"patch":[[{"diffs":[[0,"req.body);\n  if("],[1,"("],[0,"password === und"]],"start1":9268,"start2":9268,"length1":32,"length2":33},{"diffs":[[0,"ed) "],[-1,"{\n    req.flash('err', ["],[1,"|| (password === \"\" || username === \"\")) {\n    res.json({error: "],[0,"'Ple"]],"start1":9331,"start2":9331,"length1":32,"length2":72},{"diffs":[[0,"nd Password'"],[-1,"]"],[1,"}"],[0,");\n    retur"]],"start1":9425,"start2":9425,"length1":25,"length2":25},{"diffs":[[0,"g(err);\n        "],[-1,"//"],[0,"res.json({error:"]],"start1":9618,"start2":9618,"length1":34,"length2":32},{"diffs":[[0,"});\n"],[-1,"        req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n"],[0,"    "]],"start1":9654,"start2":9654,"length1":86,"length2":8},{"diffs":[[0,"unique)\n        "],[-1,"//"],[0,""],[1,""],[0,"res.json({error:"]],"start1":9760,"start2":9760,"length1":34,"length2":32},{"diffs":[[0,"});\n"],[-1,"        req.flash('err', ['Unknown Username']);\n"],[0,"    "]],"start1":9865,"start2":9865,"length1":56,"length2":8},{"diffs":[[0,"e);\n            "],[-1,"//"],[0,"res.json({error:"]],"start1":10099,"start2":10099,"length1":34,"length2":32},{"diffs":[[0,"});\n"],[-1,"            req.flash('err', ['Incorrect Password']);\n"],[0,"    "]],"start1":10152,"start2":10152,"length1":62,"length2":8},{"diffs":[[0,"{\n              "],[-1,"//"],[0,"res.json({error:"]],"start1":10236,"start2":10236,"length1":34,"length2":32},{"diffs":[[0,"});\n"],[-1,"              req.flash('err', ['Something went wrong.  Please log in again.']);\n"],[0,"    "]],"start1":10397,"start2":10397,"length1":89,"length2":8},{"diffs":[[0,"            "],[-1,"//"],[0,"res.json({er"]],"start1":10470,"start2":10470,"length1":26,"length2":24},{"diffs":[[0,"});\n"],[-1,"            req.flash('success', ['Welcome, ' +  username]);\n"],[0,"    "]],"start1":10503,"start2":10503,"length1":69,"length2":8}]],"length":16573,"saved":false}
{"ts":1379135858207,"patch":[[{"diffs":[[0,"/ ???\n  "],[1,"//"],[0,"console."]],"start1":9248,"start2":9248,"length1":16,"length2":18}]],"length":16575,"saved":false}
{"contributors":[],"silentsave":false,"ts":1382231108215,"patch":[[{"diffs":[[1,"\n"],[0,"\n/**\n * "]],"start1":0,"start2":0,"length1":8,"length2":9},{"diffs":[[0,"ed: true },\n"],[1,"    phone: {type: String, required: false},\n"],[0,"    email: {"]],"start1":774,"start2":774,"length1":24,"length2":68},{"diffs":[[0,"/  }\n//));\n\n"],[1,"// Nodemailer\nvar mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n\n"],[0,"// all envir"]],"start1":4950,"start2":4950,"length1":24,"length2":354},{"diffs":[[0,"about);\n"],[-1,"//"],[0,"app.get("]],"start1":6555,"start2":6555,"length1":18,"length2":16},{"diffs":[[0,"p.get('/"],[1,"u"],[0,"se"],[-1,"ttings"],[1,"r"],[0,"', route"]],"start1":6565,"start2":6565,"length1":24,"length2":20},{"diffs":[[0," routes."],[1,"u"],[0,"se"],[-1,"ttings"],[1,"r"],[0,");\n\napp."]],"start1":6579,"start2":6579,"length1":24,"length2":20},{"diffs":[[0,", ['"],[-1,"See ya later."],[1,"Goodbye"],[0,"']);"]],"start1":6767,"start2":6767,"length1":21,"length2":15},{"diffs":[[0,"tion;\n  "],[-1,""],[0,""],[1,"  var phone = req.body.classification;\n    "],[0,"\n    var"]],"start1":8263,"start2":8263,"length1":16,"length2":59},{"diffs":[[0," In\n"],[-1,"        //res.redirect('back');\n"],[0,"    "]],"start1":8691,"start2":8691,"length1":40,"length2":8},{"diffs":[[0,"ername; "],[-1,"// ???"],[0,"\n  var p"]],"start1":9566,"start2":9566,"length1":22,"length2":16},{"diffs":[[0,".body.password; "],[-1,"// ???"],[0,"\n  //console.log"]],"start1":9595,"start2":9595,"length1":38,"length2":32},{"diffs":[[0,"ndefined || "],[1,"password === \"\") || ("],[0,"username ==="]],"start1":9659,"start2":9659,"length1":24,"length2":45},{"diffs":[[0,"ined"],[-1,") || (password === \"\""],[1," "],[0," || "]],"start1":9710,"start2":9710,"length1":29,"length2":9},{"diffs":[[0,"assword'});\n"],[-1,"    return;\n"],[0,"  }\n  User.f"]],"start1":9790,"start2":9790,"length1":36,"length2":24},{"diffs":[[0,"});\n"],[-1,"        return;\n"],[0,"    "]],"start1":10003,"start2":10003,"length1":24,"length2":8},{"diffs":[[0,"});\n"],[-1,"        console.log({error: 'Incorrect username'});\n"],[0,"    "]],"start1":10146,"start2":10146,"length1":60,"length2":8},{"diffs":[[0,"});\n"],[-1,"              console.log({error: 'Something went wrong.  Please log in again.'});\n"],[0,"    "]],"start1":10595,"start2":10595,"length1":91,"length2":8},{"diffs":[[0,"    "],[-1,"});\n        }\n      }\n    }"],[1,"  req.flash('success', ['Welcome, ' + req.user.username]);\n            res.redirect('back');\n            return req.user;\n          });\n        }\n      }\n    });\n});\n\napp.get('/loginSuccess', function(req, res) {\n  req.flash('success', ['Welcome, ' + req.user.username]);\n  res.redirect('back'"],[0,");\n}"]],"start1":10711,"start2":10711,"length1":35,"length2":301},{"diffs":[[0,"\n// "],[-1,"Settings\n"],[1,"user\n//"],[0,"app."]],"start1":11528,"start2":11528,"length1":17,"length2":15},{"diffs":[[0,"p.get('/"],[1,"u"],[0,"se"],[-1,"ttings"],[1,"r"],[0,"',\n//  e"]],"start1":11541,"start2":11541,"length1":24,"length2":20},{"diffs":[[0,"gin'),\n "],[1," //"],[0," functio"]],"start1":11579,"start2":11579,"length1":16,"length2":19},{"diffs":[[0,"eq, res) {\n "],[1," //"],[0,"   res.rende"]],"start1":11601,"start2":11601,"length1":24,"length2":27},{"diffs":[[0,"er('"],[1,"u"],[0,"se"],[-1,"ttings"],[1,"r"],[0,"', {"]],"start1":11627,"start2":11627,"length1":16,"length2":12},{"diffs":[[0,"q.user });\n "],[1," //"],[0," });\n\n// Sug"]],"start1":11648,"start2":11648,"length1":24,"length2":27},{"diffs":[[0,"{\n  "],[-1,"var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {\n          user: \"jarvis.martin75@gmail.com\",\n          pass: \"kjyewvkjiorxkqym\" \n      }\n  });"],[0,"\n  /"]],"start1":11774,"start2":11774,"length1":322,"length2":8},{"diffs":[[0,");\n\n"],[-1,"// Forgot Password\napp.get('/f"],[1,"function randomString(length, chars) {\n  if(chars === undefined) {\n      chars = '!@#$%^&*0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  }\n  var result = '';\n  for (var i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n  return result;\n}\n\n// F"],[0,"orgot"],[1," "],[0,"Password"],[1," and/or Username\napp.get('/loginHelp"],[0,"', r"]],"start1":12489,"start2":12489,"length1":51,"length2":360},{"diffs":[[0,"t('/"],[-1,"forgotPassword"],[1,"loginHelp"],[0,"', f"]],"start1":12908,"start2":12908,"length1":22,"length2":17},{"diffs":[[0,"{\n  "],[-1,"var mailOpts, smtpTrans;\n  //Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.\n  smtpTrans = nodemailer.createTransport('SMTP', {\n      service: 'Gmail',\n      auth: {"],[1,"// Get the info from the db\n  var UserProvider = res.getUserProvider();\n  var email = req.body.email;\n  UserProvider.findOne({ 'email': email }, function(err, user) {\n    // error with query (return error and false for unique)\n    if (err) { \n      console.log(err);\n      res.json({error: err, unique: false});\n      req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n    } else if (!user) {\n      // no error with query and username was not found (it's unique)\n      //console.log({ message: 'No username found: ' + username });\n      res.json({error: null, unique: true});\n    } \n    else {\n      // no error with query and username was found (it's not unique)\n      //console.log({ message: 'Username found.' });\n      //res.json({error: null, unique: false});\n      // *** MAKE NEW PASSWORD??? ***"],[0,"\n      "],[1,"\n  "],[0,"    user"],[-1,": \"jarvis.martin75@gmail.com\","],[1,".password = randomString(10);\n      user.save();"],[0,"\n      "],[1,"\n "],[0,"    "],[-1,"pass: \"kjyewvkjiorxkqym\" \n      }\n  });\n"],[1," //return user;\n      //console.log(user);\n  \n    "],[0,"  //"]],"start1":12944,"start2":12944,"length1":323,"length2":958},{"diffs":[[0," //Mail options\n"],[1,"    "],[0,"  mailOpts = {\n "]],"start1":13899,"start2":13899,"length1":32,"length2":36},{"diffs":[[0,"lOpts = {\n      "],[1," "],[1," "],[0,"//- from: req.bo"]],"start1":13924,"start2":13924,"length1":32,"length2":34},{"diffs":[[0,"bject\n      "],[1,"  "],[0,"from: 'DoNot"]],"start1":14043,"start2":14043,"length1":24,"length2":26},{"diffs":[[0,"com',\n      "],[1,"  "],[0,"to: req.body"]],"start1":14081,"start2":14081,"length1":24,"length2":26},{"diffs":[[0,"dy.email,\n      "],[1," "],[1," "],[0,"subject: 'Forgot"]],"start1":14105,"start2":14105,"length1":32,"length2":34},{"diffs":[[0,"t: '"],[-1,"Forgot Password from venfu.com',\n      text: 'Greetings, ' + req.body.username\n"],[1,"VenFu Login Help',\n        html: '<p>Greetings, ' + user.username + '!<br>Your login information is provided below.<br>Once you sign in, you should <strong>change your password immediately</strong>.<br><br> Username: ' + user.username + '<br> password: ' + user.password + \"<br><br>Ten Thousand Blessings,<br> VenFu\"\n    "],[0,"  };"]],"start1":14129,"start2":14129,"length1":87,"length2":329},{"diffs":[[0,"u\"\n      };\n    "],[1," "],[-1,"\n"],[1,"   \n  "],[0,"    smtpTrans.se"]],"start1":14447,"start2":14447,"length1":33,"length2":39},{"diffs":[[0,"or, response) {\n"],[1,"  "],[0,"\n      "],[1,"  "],[0,"//Email not sent"]],"start1":14516,"start2":14516,"length1":39,"length2":43},{"diffs":[[0," not sent\n      "],[1,"  "],[0,"if (error) {\n   "]],"start1":14550,"start2":14550,"length1":32,"length2":34},{"diffs":[[0,"   if (error) {\n"],[1,"          alert(error);\n  "],[0,"        req.flas"]],"start1":14565,"start2":14565,"length1":32,"length2":58},{"diffs":[[0,"nse]); \n        "],[1,"  "],[0,"res.render('sugg"]],"start1":14646,"start2":14646,"length1":32,"length2":34},{"diffs":[[0,"er('"],[-1,"suggestions', { title: \"VenFu - Suggestions\"});\n      }\n      //Yay!! Email sent\n      else {\n        req.flash('success', ['Please check your email.'])"],[1,"back');\n        }\n        //Yay!! Email sent\n        else {\n          req.flash('success', ['Please check your email.']);\n          res.redirect('/');\n        }\n      });\n    }\n  });\n  console.log('user= ' + user);\n});\n\n// Update User Info\n//app.get('/updateUserInfo', routes.suggestions);\napp.post('/updateUserInfo', function (req, res) {\n  // Get the info from the db\n  var UserProvider = res.getUserProvider();\n  var email = req.body.email;\n  \n/*  UserProvider.findOne({ 'email': email }, function(err, user) {\n    // error with query (return error and false for unique)\n    if (err) { \n      console.log(err);\n      res.json({error: err, unique: false});\n      req.flash('err', ['Error. VenFu masters are seeking a solution...']);\n    } else if (!user) {\n      // no error with query and username was not found (it's unique)\n      console.log({ message: 'User not found.'});\n      req.flash('err', ['Something went wrong.']);\n    } \n    else {\n      // no error with query and username was found (it's not unique)\n      console.log({ message: 'Username found.' });\n      \n      // Make changes to user info\n      user.email = req.body.email"],[0,";\n      "],[1,"\n   "],[0,"  "],[-1,"res.redirect('/'"],[1," // Save the updated user info\n      user.save("],[0,");\n  "],[1,"\n"],[0,"    }\n  "],[-1,"  "],[0,"});"],[1,"*/\n  //console.log('user = ' + user);\n  "],[0,"\n});"]],"start1":14672,"start2":14672,"length1":204,"length2":1270},{"diffs":[[0,"SSWORD \n"],[1,"// "],[0,"app.post"]],"start1":17912,"start2":17912,"length1":16,"length2":19},{"diffs":[[0,"tion(req, res){\n"],[1,"//"],[0,"  "],[1," "],[0,"var User = res.g"]],"start1":17954,"start2":17954,"length1":34,"length2":37},{"diffs":[[0,"Provider();\n"],[1,"// "],[0,"  var passwo"]],"start1":17997,"start2":17997,"length1":24,"length2":27},{"diffs":[[0," // ???\n"],[1,"// "],[0,"  //cons"]],"start1":18047,"start2":18047,"length1":16,"length2":19},{"diffs":[[0,"(req.body);\n"],[1,"// "],[0,"  if(passwor"]],"start1":18073,"start2":18073,"length1":24,"length2":27},{"diffs":[[0,"== undefined) {\n"],[1,"// "],[0,"    res.json({er"]],"start1":18103,"start2":18103,"length1":32,"length2":35},{"diffs":[[0,"nique: false});\n"],[1,"// "],[0,"    return;\n  }\n"]],"start1":18150,"start2":18150,"length1":32,"length2":35},{"diffs":[[0,"\n//     return;\n"],[1,"// "],[0,"  }\n"],[1,"// "],[0,"  User.findOne({"]],"start1":18165,"start2":18165,"length1":36,"length2":42},{"diffs":[[0,"on(err, user) {\n"],[1,"//"],[0,"      "],[1," "],[0,"// error with qu"]],"start1":18238,"start2":18238,"length1":38,"length2":41},{"diffs":[[0,"lse for unique)\n"],[1,"// "],[0,"      if (err) {"]],"start1":18303,"start2":18303,"length1":32,"length2":35},{"diffs":[[0,"    if (err) { \n"],[1,"// "],[0,"        console."]],"start1":18324,"start2":18324,"length1":32,"length2":35},{"diffs":[[0,"e.log(err);\n"],[1,"//"],[0,"        "],[1," "],[0,"res.json({er"]],"start1":18357,"start2":18357,"length1":32,"length2":35},{"diffs":[[0,"nique: false});\n"],[1,"// "],[0,"        req.flas"]],"start1":18403,"start2":18403,"length1":32,"length2":35},{"diffs":[[0,"solution...']);\n"],[1,"// "],[0,"      } else if "]],"start1":18484,"start2":18484,"length1":32,"length2":35},{"diffs":[[0,"se if (!user) {\n"],[1,"// "],[0,"        // no er"]],"start1":18513,"start2":18513,"length1":32,"length2":35},{"diffs":[[0,"d (it's unique)\n"],[1,"// "],[0,"        //consol"]],"start1":18588,"start2":18588,"length1":32,"length2":35},{"diffs":[[0,"assword });\n"],[1,"// "],[0,"        res."]],"start1":18669,"start2":18669,"length1":24,"length2":27},{"diffs":[[0,"unique: true});\n"],[1,"// "],[0,"      } else {\n "]],"start1":18715,"start2":18715,"length1":32,"length2":35},{"diffs":[[0,"       } else {\n"],[1,"// "],[0,"        // no er"]],"start1":18733,"start2":18733,"length1":32,"length2":35},{"diffs":[[0,"t's not unique)\n"],[1,"// "],[0,"        //consol"]],"start1":18808,"start2":18808,"length1":32,"length2":35},{"diffs":[[0,"ord found.' });\n"],[1,"// "],[0,"        res.json"]],"start1":18866,"start2":18866,"length1":32,"length2":35},{"diffs":[[0,"alse});\n"],[1,"// "],[0,"      }\n"],[1,"//"],[0,"    "],[1," "],[0,"});\n"],[1,"// "],[0,"});\n\nhtt"]],"start1":18925,"start2":18925,"length1":32,"length2":41}]],"length":19096,"saved":false}
{"ts":1382231206451,"patch":[[{"diffs":[[0,"fo from the db\n "],[1," //"],[0," var UserProvide"]],"start1":15031,"start2":15031,"length1":32,"length2":35},{"diffs":[[0,"mail;\n  "],[1,"console.log(req.body);\n  \n  res.json({});"],[0,"\n/*  Use"]],"start1":15117,"start2":15117,"length1":16,"length2":57}]],"length":19140,"saved":false}
{"ts":1382231650137,"patch":[[{"diffs":[[0,"sole.log(req"],[-1,".body"],[0,");\n  \n  res."]],"start1":15128,"start2":15128,"length1":29,"length2":24}]],"length":19135,"saved":false}
{"ts":1382231661873,"patch":[[{"diffs":[[0,"g(req);\n"],[1,"  console.log(res);\n"],[0,"  \n  res"]],"start1":15135,"start2":15135,"length1":16,"length2":36}]],"length":19155,"saved":false}
{"ts":1382231927500,"patch":[[{"diffs":[[0,".email;\n"],[1,"  var prev_email = req.user.email;\n"],[0,"  consol"]],"start1":15115,"start2":15115,"length1":16,"length2":51}]],"length":19190,"saved":false}
{"ts":1382232785640,"patch":[[{"diffs":[[0,"the db\n "],[-1," //"],[0," var Use"]],"start1":15039,"start2":15039,"length1":19,"length2":16},{"diffs":[[0,"serProvider();\n "],[1," //"],[0," var email = req"]],"start1":15075,"start2":15075,"length1":32,"length2":35},{"diffs":[[0,"email;\n "],[1," //"],[0," var pre"]],"start1":15116,"start2":15116,"length1":16,"length2":19},{"diffs":[[0,"email;\n "],[1," var username = req.user.username;\n  //"],[0," console"]],"start1":15154,"start2":15154,"length1":16,"length2":55},{"diffs":[[0,".log(req);\n "],[1," //"],[0," console.log"]],"start1":15209,"start2":15209,"length1":24,"length2":27},{"diffs":[[0,"s);\n  \n "],[1," //"],[0," res.jso"]],"start1":15239,"start2":15239,"length1":16,"length2":19},{"diffs":[[0,"on({});\n"],[-1,"/*"],[0,"  UserPr"]],"start1":15257,"start2":15257,"length1":18,"length2":16},{"diffs":[[0,".findOne({ '"],[-1,"email': email"],[1,"username': username"],[0," }, function"]],"start1":15279,"start2":15279,"length1":37,"length2":43},{"diffs":[[0,"    "],[-1,"// Make changes to user info\n      user.email = req.body.email;"],[1,"var type = req.body.type;\n      \n      // Make changes to user info\n      if(type != 'password') {\n      } else {\n        user[type] = req.body.data;\n      }\n      "],[0,"\n   "]],"start1":15900,"start2":15900,"length1":71,"length2":172},{"diffs":[[0,"();\n"],[-1,"  \n"],[0,"    }\n"],[1,""],[0,"  });"],[-1,"*/"],[0,"\n  /"]],"start1":16127,"start2":16127,"length1":24,"length2":19}]],"length":19338,"saved":false}
{"ts":1382233117014,"patch":[[{"diffs":[[0,"r info\n     "],[1," //"],[0," if(type != "]],"start1":15965,"start2":15965,"length1":24,"length2":27},{"diffs":[[0,"rd') {\n     "],[1," //"],[0," } else {\n  "]],"start1":15999,"start2":15999,"length1":24,"length2":27},{"diffs":[[0,";\n      "],[-1,"}\n      "],[1,"// }"],[0,"\n      \n"]],"start1":16058,"start2":16058,"length1":24,"length2":20}]],"length":19340,"saved":false}
{"ts":1382233170702,"patch":[[{"diffs":[[0,"rname;\n "],[-1," //"],[0," console"]],"start1":15190,"start2":15190,"length1":19,"length2":16},{"diffs":[[0,"sole.log(req"],[1,".body"],[0,");\n  // cons"]],"start1":15202,"start2":15202,"length1":24,"length2":29}]],"length":19342,"saved":false}
{"ts":1382233236620,"patch":[[{"diffs":[[0,"s);\n  \n "],[-1," //"],[0," res.jso"]],"start1":15241,"start2":15241,"length1":19,"length2":16},{"diffs":[[0,"n({});\n "],[1," //"],[0," UserPro"]],"start1":15257,"start2":15257,"length1":16,"length2":19},{"diffs":[[0,"n(err, user) {\n "],[1," //"],[0,"   // error with"]],"start1":15323,"start2":15323,"length1":32,"length2":35},{"diffs":[[0,"se for unique)\n "],[1," //"],[0,"   if (err) { \n "]],"start1":15386,"start2":15386,"length1":32,"length2":35},{"diffs":[[0,"   if (err) { \n "],[1," //"],[0,"     console.log"]],"start1":15405,"start2":15405,"length1":32,"length2":35},{"diffs":[[0,"sole.log(err);\n "],[1," //"],[0,"     res.json({e"]],"start1":15432,"start2":15432,"length1":32,"length2":35},{"diffs":[[0,"ique: false});\n "],[1," //"],[0,"     req.flash('"]],"start1":15480,"start2":15480,"length1":32,"length2":35},{"diffs":[[0,"olution...']);\n "],[1," //"],[0,"   } else if (!u"]],"start1":15559,"start2":15559,"length1":32,"length2":35},{"diffs":[[0,"e if (!user) {\n "],[1," //"],[0,"     // no error"]],"start1":15586,"start2":15586,"length1":32,"length2":35},{"diffs":[[0,"(it's unique)\n  "],[1,"//"],[0,"    "],[1," "],[0,"console.log({ me"]],"start1":15660,"start2":15660,"length1":36,"length2":39},{"diffs":[[0,"found.'});\n "],[1," //"],[0,"     req.fla"]],"start1":15716,"start2":15716,"length1":24,"length2":27},{"diffs":[[0,"g.']);\n "],[1," //"],[0,"   } \n  "],[1,"//"],[0,"  "],[1," "],[0,"else {\n "],[1," //"],[0,"     // "]],"start1":15774,"start2":15774,"length1":34,"length2":43},{"diffs":[[0,"ot unique)\n "],[1," //"],[0,"     console"]],"start1":15867,"start2":15867,"length1":24,"length2":27},{"diffs":[[0,"});\n      \n "],[1," //"],[0,"     var typ"]],"start1":15928,"start2":15928,"length1":24,"length2":27},{"diffs":[[0,"y.type;\n      \n "],[1," //"],[0,"     // Make cha"]],"start1":15966,"start2":15966,"length1":32,"length2":35},{"diffs":[[0," info\n  "],[1,"//"],[0,"    "],[1," "],[0,"// if(ty"]],"start1":16013,"start2":16013,"length1":20,"length2":23},{"diffs":[[0,"ssword') {\n "],[1," //"],[0,"     // } el"]],"start1":16045,"start2":16045,"length1":24,"length2":27},{"diffs":[[0,"/ } else {\n "],[1," //"],[0,"       user["]],"start1":16066,"start2":16066,"length1":24,"length2":27},{"diffs":[[0,".data;\n "],[1," //"],[0,"     // "]],"start1":16109,"start2":16109,"length1":16,"length2":19},{"diffs":[[0,"/ }\n      \n "],[1," //"],[0,"     // Save"]],"start1":16126,"start2":16126,"length1":24,"length2":27},{"diffs":[[0,"r info\n "],[1," //"],[0,"     use"]],"start1":16169,"start2":16169,"length1":16,"length2":19},{"diffs":[[0,"er.save();\n "],[1," //"],[0,"   }\n "],[1," //"],[0," });\n  //con"]],"start1":16187,"start2":16187,"length1":30,"length2":36}]],"length":19411,"saved":false}
{"ts":1382233365621,"patch":[[{"diffs":[[0,"s);\n  \n "],[1," //"],[0," res.jso"]],"start1":15241,"start2":15241,"length1":16,"length2":19},{"diffs":[[0,"n({});\n "],[-1," //"],[0," UserPro"]],"start1":15260,"start2":15260,"length1":19,"length2":16},{"diffs":[[0,"ser) {\n "],[-1," //"],[0,"   // er"]],"start1":15331,"start2":15331,"length1":19,"length2":16},{"diffs":[[0,"nique)\n "],[-1," //"],[0,"   if (e"]],"start1":15391,"start2":15391,"length1":19,"length2":16},{"diffs":[[0,"rr) { \n "],[-1," //"],[0,"     con"]],"start1":15407,"start2":15407,"length1":19,"length2":16},{"diffs":[[0,".log(err);\n "],[-1," //"],[0,"     res.jso"]],"start1":15427,"start2":15427,"length1":27,"length2":24},{"diffs":[[0,": false});\n "],[-1," //"],[0,"     req.fla"]],"start1":15472,"start2":15472,"length1":27,"length2":24},{"diffs":[[0,"ion...']);\n "],[-1," //"],[0,"   } else if"]],"start1":15548,"start2":15548,"length1":27,"length2":24},{"diffs":[[0," (!user) {\n "],[-1," //"],[0,"     // no e"]],"start1":15572,"start2":15572,"length1":27,"length2":24},{"diffs":[[0,"(it's unique)\n  "],[-1,"//"],[0,"    "],[-1," "],[0,"console.log({ me"]],"start1":15639,"start2":15639,"length1":39,"length2":36},{"diffs":[[0,"d.'});\n "],[-1," //"],[0,"     req"]],"start1":15696,"start2":15696,"length1":19,"length2":16},{"diffs":[[0,");\n "],[-1," //"],[0,"   } \n  "],[-1,"//"],[0,"  "],[-1," "],[0,"else {\n "],[-1," //"],[0,"    "]],"start1":15751,"start2":15751,"length1":35,"length2":26},{"diffs":[[0,"nique)\n "],[-1," //"],[0,"     con"]],"start1":15835,"start2":15835,"length1":19,"length2":16},{"diffs":[[0,"});\n      \n "],[-1," //"],[0,"     var typ"]],"start1":15889,"start2":15889,"length1":27,"length2":24},{"diffs":[[0,"y.type;\n      \n "],[-1," //"],[0,"     // Make cha"]],"start1":15924,"start2":15924,"length1":35,"length2":32},{"diffs":[[0," info\n  "],[-1,"//"],[0,"    "],[-1," "],[0,"// if(ty"]],"start1":15968,"start2":15968,"length1":23,"length2":20},{"diffs":[[0,"ssword') {\n "],[-1," //"],[0,"     // } el"]],"start1":15997,"start2":15997,"length1":27,"length2":24},{"diffs":[[0,"else {\n "],[-1," //"],[0,"       u"]],"start1":16019,"start2":16019,"length1":19,"length2":16},{"diffs":[[0,".data;\n "],[-1," //"],[0,"     // "]],"start1":16055,"start2":16055,"length1":19,"length2":16},{"diffs":[[0,"      \n "],[-1," //"],[0,"     // "]],"start1":16073,"start2":16073,"length1":19,"length2":16},{"diffs":[[0,"r info\n "],[-1," //"],[0,"     use"]],"start1":16109,"start2":16109,"length1":19,"length2":16},{"diffs":[[0,");\n "],[-1," //"],[0,"   }\n "],[-1," //"],[0," });"]],"start1":16132,"start2":16132,"length1":20,"length2":14}]],"length":19342,"saved":false}
{"contributors":[],"silentsave":false,"ts":1382233773500,"patch":[[{"diffs":[[0,"ser.save();\n"],[1,"      \n      // Let the user know it worked\n      req.flash('success', ['Profile updated.']);\n"],[0,"    }\n  });\n"]],"start1":16123,"start2":16123,"length1":24,"length2":118}]],"length":19436,"saved":false}
{"ts":1382233836011,"patch":[[{"diffs":[[0,"pdated.']);\n"],[1,"      \n      // Put the user on the same page.\n      res.redirect('/');\n"],[0,"    }\n  });\n"]],"start1":16217,"start2":16217,"length1":24,"length2":96}]],"length":19508,"saved":false}
{"ts":1382234118771,"patch":[[{"diffs":[[0," = this;"],[1,"\n    console.log('pre-save');"],[0,"\n\n    //"]],"start1":1419,"start2":1419,"length1":16,"length2":45},{"diffs":[[0,"= salt;\n"],[1,"            \n            console.log('post-salt');\n"],[0,"        "]],"start1":1969,"start2":1969,"length1":16,"length2":67},{"diffs":[[0,"ser.save();\n"],[1,"      \n      // Let the user know it worked\n      req.flash('success', ['Profile updated.']);\n      \n      // Put the user on the same page.\n      res.redirect('/');\n"],[0,"    }\n  });\n"]],"start1":16203,"start2":16203,"length1":24,"length2":190}]],"length":19588,"saved":false}
{"ts":1382234403440,"patch":[[{"diffs":[[0,"sword'))"],[1," {\n      console.log('password not modified');\n     "],[0," return "]],"start1":1553,"start2":1553,"length1":16,"length2":68},{"diffs":[[0," next();"],[1,"\n    }"],[0,"\n\n    //"]],"start1":1620,"start2":1620,"length1":16,"length2":22}]],"length":19646,"saved":false}
{"ts":1382234470320,"patch":[[{"diffs":[[0,"        if (err)"],[1," {\n          console.log('salt error: ' + err);\n         "],[0," return next(err"]],"start1":1718,"start2":1718,"length1":32,"length2":89},{"diffs":[[0,"eturn next(err);"],[1,"\n        }"],[0,"\n\n        // has"]],"start1":1793,"start2":1793,"length1":32,"length2":42},{"diffs":[[0,"        "],[-1,"    "],[0,"if (err)"],[1," {\n          console.log('hash error: ' + err);\n         "],[0," return "]],"start1":1933,"start2":1933,"length1":28,"length2":81},{"diffs":[[0,"xt(err);"],[1,"\n        }"],[0,"\n\n      "]],"start1":2016,"start2":2016,"length1":16,"length2":26}]],"length":19776,"saved":false}
{"ts":1382234482732,"patch":[[{"diffs":[[0,"hash) {\n        "],[1,"  "],[0,"if (err) {\n     "]],"start1":1925,"start2":1925,"length1":32,"length2":34},{"diffs":[[0,"     if (err) {\n"],[1,"  "],[0,"          consol"]],"start1":1938,"start2":1938,"length1":32,"length2":34},{"diffs":[[0,"err);\n          "],[1,"  "],[0,"return next(err)"]],"start1":1995,"start2":1995,"length1":32,"length2":34},{"diffs":[[0,"turn next(err);\n"],[1,"  "],[0,"        }\n\n     "]],"start1":2015,"start2":2015,"length1":32,"length2":34}]],"length":19784,"saved":false}
{"ts":1382234861968,"patch":[[{"diffs":[[0,"y.data;\n"],[1,"        console.log('updated user: ' + user);\n"],[0,"      //"]],"start1":16330,"start2":16330,"length1":16,"length2":62}]],"length":19830,"saved":false}
{"ts":1382234878309,"patch":[[{"diffs":[[0,".body);\n"],[1,"  console.log('existing user: ' + user);\n"],[0,"  // con"]],"start1":15490,"start2":15490,"length1":16,"length2":57}]],"length":19871,"saved":false}
{"ts":1382235010924,"patch":[[{"diffs":[[0,"sting user: ' + "],[1,"req."],[0,"user);\n  // cons"]],"start1":15516,"start2":15516,"length1":32,"length2":36}]],"length":19875,"saved":false}
{"ts":1382235090711,"patch":[[{"diffs":[[0,"    // } else {\n"],[1,"        console.log('changing type: ' + type);\n"],[0,"        user[typ"]],"start1":16331,"start2":16331,"length1":32,"length2":79}]],"length":19922,"saved":false}
{"ts":1382235097908,"patch":[[{"diffs":[[0,"nfo\n"],[-1,"      // if(type != 'password') {\n      // } else {\n"],[0,"    "]],"start1":16291,"start2":16291,"length1":60,"length2":8},{"diffs":[[0,"r);\n"],[-1,"      // }\n"],[0,"    "]],"start1":16420,"start2":16420,"length1":19,"length2":8}]],"length":19859,"saved":false}
{"ts":1382235299776,"patch":[[{"diffs":[[0,"sole.log(req"],[-1,".body"],[0,");\n  console"]],"start1":15478,"start2":15478,"length1":29,"length2":24}]],"length":19854,"saved":false}
{"ts":1382236346638,"patch":[[{"diffs":[[0,"found.' });\n"],[1,"      console.log(req.body);\n"],[0,"      \n     "]],"start1":16197,"start2":16197,"length1":24,"length2":53}]],"length":19883,"saved":false}
{"ts":1382237691413,"patch":[[{"diffs":[[0," = this;"],[1,"\n    console.log('pre-save');"],[0,"\n\n    //"]],"start1":1419,"start2":1419,"length1":16,"length2":45},{"diffs":[[0,"sword'))"],[1," {\n      console.log('password not modified');\n     "],[0," return "]],"start1":1553,"start2":1553,"length1":16,"length2":68},{"diffs":[[0," next();"],[1,"\n    }"],[0,"\n\n    //"]],"start1":1620,"start2":1620,"length1":16,"length2":22},{"diffs":[[0,"        if (err)"],[1," {\n          console.log('salt error: ' + err);\n         "],[0," return next(err"]],"start1":1718,"start2":1718,"length1":32,"length2":89},{"diffs":[[0,"eturn next(err);"],[1,"\n        }"],[0,"\n\n        // has"]],"start1":1793,"start2":1793,"length1":32,"length2":42},{"diffs":[[0,"        "],[-1,"  "],[0,"if (err)"],[1," {\n            console.log('hash error: ' + err);\n           "],[0," return "]],"start1":1935,"start2":1935,"length1":26,"length2":85},{"diffs":[[0,"xt(err);"],[1,"\n          }"],[0,"\n\n      "]],"start1":2022,"start2":2022,"length1":16,"length2":28},{"diffs":[[0,"t = salt"],[-1,""],[0,""],[1,";\n            \n            console.log('post-salt')"],[0,";\n      "]],"start1":2163,"start2":2163,"length1":16,"length2":67},{"diffs":[[0,"sole.log(req"],[-1,".body"],[1,");\n  console.log('existing user: ' + req.user"],[0,");\n  // cons"]],"start1":15478,"start2":15478,"length1":29,"length2":69},{"diffs":[[0,"' });\n      "],[-1,""],[0,""],[1,"console.log(req.body);\n      "],[0,"\n      var t"]],"start1":16203,"start2":16203,"length1":24,"length2":53},{"diffs":[[0,"    "],[-1,"// if(type != 'password') {\n      // } else {"],[1,"  console.log('changing type: ' + type);"],[0,"\n   "]],"start1":16321,"start2":16321,"length1":53,"length2":48},{"diffs":[[0,";\n      "],[-1,"// }"],[1,"  console.log('updated user: ' + user);"],[0,"\n      \n"]],"start1":16400,"start2":16400,"length1":20,"length2":55}]],"length":19883,"saved":false}
{"ts":1382239863870,"patch":[[{"diffs":[[0,"  res.redirect('"],[-1,"/"],[1,"back"],[0,"');\n    }\n  });\n"]],"start1":16655,"start2":16655,"length1":33,"length2":36}]],"length":19886,"saved":false}
{"ts":1382239986677,"patch":[[{"diffs":[[0,"username;\n  "],[1,"//"],[0,"console.log("]],"start1":15463,"start2":15463,"length1":24,"length2":26}]],"length":19888,"saved":false}
{"ts":1382240192139,"patch":[[{"diffs":[[0,"  res.redirect('"],[-1,"back"],[1,"/user"],[0,"');\n    }\n  });\n"]],"start1":16657,"start2":16657,"length1":36,"length2":37}]],"length":19889,"saved":false}
{"ts":1382240738483,"patch":[[{"diffs":[[0,"direct('"],[-1,"/user"],[1,"back"],[0,"');\n    "]],"start1":16665,"start2":16665,"length1":21,"length2":20}]],"length":19888,"saved":false}
{"ts":1382240844969,"patch":[[{"diffs":[[0,"  res.redirect('"],[-1,"back"],[1,"/user"],[0,"');\n    }\n  });\n"]],"start1":16657,"start2":16657,"length1":36,"length2":37}]],"length":19889,"saved":false}
{"ts":1382240991257,"patch":[[{"diffs":[[0,"direct('"],[-1,"/user"],[1,"back"],[0,"');\n    "]],"start1":16665,"start2":16665,"length1":21,"length2":20}]],"length":19888,"saved":false}
{"ts":1382241336622,"patch":[[{"diffs":[[0,"  res.redirect('"],[-1,"back"],[1,"/"],[0,"');\n    }\n  });\n"]],"start1":16657,"start2":16657,"length1":36,"length2":33}]],"length":19885,"saved":false}
{"ts":1382241948457,"patch":[[{"diffs":[[0,";\n  "],[-1,"// var email = req.body.email;\n  // var prev_email = req.user.email;\n  "],[0,""],[1,""],[0,"var "]],"start1":15364,"start2":15364,"length1":79,"length2":8},{"diffs":[[0,"\n  \n"],[-1,"  // res.json({});\n"],[0,"  Us"]],"start1":15491,"start2":15491,"length1":27,"length2":8},{"diffs":[[0,"t unique)\n      "],[1,"//"],[0,"console.log({ me"]],"start1":16060,"start2":16060,"length1":32,"length2":34},{"diffs":[[0,"' });\n      "],[1,"//"],[0,"console.log("]],"start1":16117,"start2":16117,"length1":24,"length2":26},{"diffs":[[0," info\n      "],[-1,"  "],[1,"//"],[0,"console.log("]],"start1":16229,"start2":16229,"length1":26,"length2":26},{"diffs":[[0,"ype);\n      "],[-1,"  "],[0,"user[type] ="]],"start1":16276,"start2":16276,"length1":26,"length2":24},{"diffs":[[0,"y.data;\n"],[-1,"  "],[0,"      co"]],"start1":16308,"start2":16308,"length1":18,"length2":16},{"diffs":[[0," res.redirect('/"],[-1,""],[0,""],[1,"user"],[0,"');\n    }\n  });\n"]],"start1":16568,"start2":16568,"length1":32,"length2":36}]],"length":19799,"saved":false}
{"ts":1382242101125,"patch":[[{"diffs":[[0,"irect('/"],[-1,"user"],[0,"');\n    "]],"start1":16576,"start2":16576,"length1":20,"length2":16}]],"length":19795,"saved":false}
{"ts":1382244795813,"patch":[[{"diffs":[[0,"  res.redirect('"],[-1,"/"],[1,"back"],[0,"');\n    }\n  });\n"]],"start1":16567,"start2":16567,"length1":33,"length2":36}]],"length":19798,"saved":false}
{"ts":1382246306311,"patch":[[{"diffs":[[0," },\n    "],[-1,"phone"],[1,"tel"],[0,": {type:"]],"start1":782,"start2":782,"length1":21,"length2":19}]],"length":19796,"saved":false}
{"ts":1382246368626,"patch":[[{"diffs":[[0,"var "],[-1,"phone"],[1,"tel"],[0," = r"]],"start1":8547,"start2":8547,"length1":13,"length2":11},{"diffs":[[0,"ication,"],[-1," "],[1,"\n      tel: tel,"],[0,"\n      p"]],"start1":8690,"start2":8690,"length1":17,"length2":32}]],"length":19809,"saved":false}
{"ts":1382247659668,"patch":[[{"diffs":[[0," = req.body."],[-1,"classification"],[1,"tel"],[0,";\n    \n    v"]],"start1":8554,"start2":8554,"length1":38,"length2":27}]],"length":19798,"saved":false}
{"ts":1382249415353,"patch":[[{"diffs":[[0,"data;\n      "],[1,"//"],[0,"console.log("]],"start1":16310,"start2":16310,"length1":24,"length2":26},{"diffs":[[0," + user);\n      "],[1,"console.log(req.body.type + req.body.data);"],[0,"\n      // Save t"]],"start1":16352,"start2":16352,"length1":32,"length2":75}]],"length":19843,"saved":false}
{"ts":1382249548482,"patch":[[{"diffs":[[0,"ole.log("],[-1,"req.body."],[0,"type + r"]],"start1":16372,"start2":16372,"length1":25,"length2":16}]],"length":19834,"saved":false}
{"ts":1382249850363,"patch":[[{"diffs":[[0,"ody.data;\n      "],[-1,"//"],[0,"console.log('upd"]],"start1":16306,"start2":16306,"length1":34,"length2":32},{"diffs":[[0,"r);\n"],[-1,"      console.log(type + req.body.data);"],[0,"\n   "]],"start1":16356,"start2":16356,"length1":48,"length2":8}]],"length":19792,"saved":false}
